b.Vp=f.Vp;b.gp=f.gp;b.placeholderBuffer=Math.max(0,g+10-d)}}}function g(b,c){for(var d=b.bitrates[c],e=b.utilities[c],f=0,g=c-1;0<=g;--g)if(b.utilities[g]<b.utilities[c])var h=b.bitrates[g],f=Math.max(f,b.Vp*(b.gp+(d*b.utilities[g]-h*e)/(d-h)));return f}function h(){for(var b in w)w.hasOwnProperty(b)&&\n2===w[b].state&&(w[b].placeholderBuffer=0)}function k(){for(var b in w)if(w.hasOwnProperty(b)){var c=w[b];0!==c.state&&(c.state=1,e(c))}}function m(){}function q(b){if(b&&b.chunk&&b.chunk.mediaInfo){var c=w[b.chunk.mediaInfo.type];if(c&&0!==c.state){var d=b.chunk.start;isNaN(c.mostAdvancedSegmentStart)||d>c.mostAdvancedSegmentStart?(c.mostAdvancedSegmentStart=d,c.lastSegmentWasReplacement=!1):c.lastSegmentWasReplacement=!0;c.lastSegmentStart=d;c.lastSegmentDurationS=b.chunk.duration;c.lastQuality=\nb.chunk.quality;t(c,b.chunk.mediaInfo.type)}}}function n(b){if(b&&b.metric===za.HTTP_REQUEST&&b.value&&b.value.type===da.MEDIA_SEGMENT_TYPE&&b.value.trace&&b.value.trace.length){var c=w[b.mediaType];c&&0!==c.state&&(c.lastSegmentRequestTimeMs=b.value.trequest.getTime(),c.lastSegmentFinishTimeMs=b.value._tfinish.getTime(),t(c,b.mediaType))}}function t(b,c){isNaN(b.lastSegmentStart)||isNaN(b.lastSegmentRequestTimeMs)||isNaN(b.placeholderBuffer)||((b.placeholderBuffer*=.99,isNaN(b.lastSegmentFinishTimeMs))||\n(c=ea.getCurrentBufferLevel(z.getReadOnlyMetricsFor(c))+.001*(b.lastSegmentFinishTimeMs-b.lastSegmentRequestTimeMs),b.placeholderBuffer=Math.min(Math.max(0,b.Vp*(b.utilities[b.lastQuality]+b.gp)-c),b.placeholderBuffer)),b.lastSegmentWasReplacement&&!isNaN(b.lastSegmentDurationS)&&(b.placeholderBuffer+=b.lastSegmentDurationS),b.lastSegmentStart=NaN,b.lastSegmentRequestTimeMs=NaN)}function p(b){if(b){var c=w[b.mediaType];c&&0!==c.state&&(c.abrQuality=b.newQuality)}}function u(b){if(b){var c=w[b.mediaType];\nif(c&&0!==c.state){b=ea.getCurrentBufferLevel(z.getReadOnlyMetricsFor(b.mediaType));var d=0<c.abrQuality?g(c,c.abrQuality):10;c.placeholderBuffer=Math.min(c.placeholderBuffer,Math.max(0,d-b))}}}b=b||{};var pa=this.context,Ea=Ja(pa).getInstance().log,ea=b.dashMetrics,z=b.metricsModel,v=b.mediaPlayerModel,D=l(pa).getInstance(),y=void 0,w=void 0,y={getMaxIndex:function(b){var c=b.getMediaInfo(),h=b.getMediaType(),l=z.getReadOnlyMetricsFor(h),k=b.getStreamProcessor(),m=b.getStreamInfo(),q=b.getAbrController(),\nn=q.getThroughputHistory(),t=m?m.id:null,p=m&&m.manifestInfo&&m.manifestInfo.isDynamic,u=b.useBufferOccupancyABR(),m=ha(pa).create();if(m.reason=m.reason||{},!u)return m;k.getScheduleController().setTimeToLoadDelay(0);b=function(b){var c=b.getMediaType(),e=w[c];return e?0!==e.state&&f(e,c):(e=d(b),w[c]=e),e}(b);if(0===b.state)return m;var l=ea.getCurrentBufferLevel(l),u=n.getAverageThroughput(h,p),Sa=n.getSafeAverageThroughput(h,p),n=n.getAverageLatency(h),p=void 0;if(m.reason.state=b.state,m.reason.throughput=\nu,m.reason.latency=n,isNaN(u))return m;switch(b.state){case 1:p=q.getQualityForBitrate(c,Sa,n);m.quality=p;m.reason.throughput=Sa;b.placeholderBuffer=Math.max(0,g(b,p)-l);b.lastQuality=p;!isNaN(b.lastSegmentDurationS)&&l>=b.lastSegmentDurationS&&(b.state=2);break;case 2:!function(b,c){var d=Date.now();isNaN(b.lastSegmentFinishTimeMs)?isNaN(b.lastCallTimeMs)||(b.placeholderBuffer+=Math.max(0,.001*(d-b.lastCallTimeMs))):b.placeholderBuffer+=Math.max(0,.001*(d-b.lastSegmentFinishTimeMs));b.lastCallTimeMs=\nd;b.lastSegmentStart=NaN;b.lastSegmentRequestTimeMs=NaN;b.lastSegmentFinishTimeMs=NaN;f(b,c)}(b,h);p=function(b,c){for(var d=b.bitrates.length,e=NaN,f=NaN,g=0;g<d;++g){var h=(b.Vp*(b.utilities[g]+b.gp)-c)/b.bitrates[g];(isNaN(f)||h>=f)&&(f=h,e=g)}return e}(b,l+b.placeholderBuffer);c=q.getQualityForBitrate(c,Sa,n);p>b.lastQuality&&p>c&&(p=Math.max(c,b.lastQuality));c=Math.max(0,l+b.placeholderBuffer-b.Vp*(b.utilities[p]+b.gp));c<=b.placeholderBuffer?(b.placeholderBuffer-=c,c=0):(c-=b.placeholderBuffer,\nb.placeholderBuffer=0,p<q.getTopQualityIndexFor(h,t)?k.getScheduleController().setTimeToLoadDelay(1E3*c):c=0);m.quality=p;m.reason.throughput=u;m.reason.latency=n;m.reason.bufferLevel=l;m.reason.placeholderBuffer=b.placeholderBuffer;m.reason.delay=c;b.lastQuality=p;break;default:Ea(\"BOLA ABR rule invoked in bad state.\"),m.quality=q.getQualityForBitrate(c,Sa,n),m.reason.state=b.state,m.reason.throughput=Sa,m.reason.latency=n,b.state=1,e(b)}return m},reset:function(){w={};D.off(x.BUFFER_EMPTY,h,y);\nD.off(x.PLAYBACK_SEEKING,k,y);D.off(x.PERIOD_SWITCH_STARTED,m,y);D.off(x.MEDIA_FRAGMENT_LOADED,q,y);D.off(x.METRIC_ADDED,n,y);D.off(x.QUALITY_CHANGE_REQUESTED,p,y);D.off(x.FRAGMENT_LOADING_ABANDONED,u,y)}},w={};return D.on(x.BUFFER_EMPTY,h,y),D.on(x.PLAYBACK_SEEKING,k,y),D.on(x.PERIOD_SWITCH_STARTED,m,y),D.on(x.MEDIA_FRAGMENT_LOADED,q,y),D.on(x.METRIC_ADDED,n,y),D.on(x.QUALITY_CHANGE_REQUESTED,p,y),D.on(x.FRAGMENT_LOADING_ABANDONED,u,y),y}function P(b){function c(b){return b.filter(function(b){return b.quality>\nha.NO_CHANGE})}function d(b){var c,d={},f=void 0,g=void 0,h=void 0;if(0!==b.length){d[ha.PRIORITY.STRONG]=ha.NO_CHANGE;d[ha.PRIORITY.WEAK]=ha.NO_CHANGE;d[ha.PRIORITY.DEFAULT]=ha.NO_CHANGE;var l=0;for(c=b.length;l<c;l+=1)(f=b[l]).quality!==ha.NO_CHANGE&&(d[f.priority]=d[f.priority]>ha.NO_CHANGE?Math.min(d[f.priority],f.quality):f.quality);return d[ha.PRIORITY.WEAK]!==ha.NO_CHANGE&&(g=d[ha.PRIORITY.WEAK]),d[ha.PRIORITY.DEFAULT]!==ha.NO_CHANGE&&(g=d[ha.PRIORITY.DEFAULT]),d[ha.PRIORITY.STRONG]!==ha.NO_CHANGE&&\n(g=d[ha.PRIORITY.STRONG]),g!==ha.NO_CHANGE&&(h=g),ha(e).create(h)}}b=b||{};var e=this.context,f=b.mediaPlayerModel,g=b.metricsModel,h=b.dashMetrics,l=void 0,m=void 0;return{initialize:function(){l=[];m=[];f.getUseDefaultABRRules()&&(l.push(Gd(e).create({metricsModel:g,dashMetrics:h,mediaPlayerModel:f})),l.push(Id(e).create({metricsModel:g,dashMetrics:h})),m.push(Fd(e).create({metricsModel:g,dashMetrics:h,mediaPlayerModel:f})));f.getABRCustomRules().forEach(function(b){\"qualitySwitchRules\"===b.type&&\nl.push(b.rule(e).create());\"abandonFragmentRules\"===b.type&&m.push(b.rule(e).create())})},reset:function(){[l,m].forEach(function(b){b&&b.length&&b.forEach(function(b){return b.reset&&b.reset()})});l=[];m=[]},getMaxQuality:function(b){return d(c(l.map(function(c){return c.getMaxIndex(b)})))||ha(e).create()},shouldAbandonFragment:function(b){return d(c(m.map(function(c){return c.shouldAbandon(b)})))||ha(e).create()}}}function ca(b){var c=(b=b||{}).abrController,d=b.streamProcessor,e=b.streamProcessor.getCurrentRepresentationInfo(),\nf=b.switchHistory,g=b.droppedFramesHistory,h=b.currentRequest,l=b.useBufferOccupancyABR;return{getMediaType:function(){return e.mediaInfo.type},getMediaInfo:function(){return e.mediaInfo},getDroppedFramesHistory:function(){return g},getCurrentRequest:function(){return h},getSwitchHistory:function(){return f},getStreamInfo:function(){return e.mediaInfo.streamInfo},getStreamProcessor:function(){return d},getAbrController:function(){return c},getRepresentationInfo:function(){return e},useBufferOccupancyABR:function(){return l}}}\nfunction fa(){var b=[],c=[];return{push:function(d){d.newValue===ha.NO_CHANGE&&(d.newValue=d.oldValue);b[d.oldValue]||(b[d.oldValue]={noDrops:0,drops:0,dropSize:0});var e=d.newValue-d.oldValue,f=0>e?1:0,e=f?-e:0,g=f?0:1;if(b[d.oldValue].drops+=f,b[d.oldValue].dropSize+=e,b[d.oldValue].noDrops+=g,c.push({idx:d.oldValue,noDrop:g,drop:f,dropSize:e}),8<c.length)d=c.shift(),b[d.idx].drops-=d.drop,b[d.idx].dropSize-=d.dropSize,b[d.idx].noDrops-=d.noDrop},getSwitchRequests:function(){return b},reset:function(){b=\n[];c=[]}}}function ba(){var b=[],c=0,d=0;return{push:function(e,f){var g=f&&f.droppedVideoFrames?f.droppedVideoFrames:0;f=f&&f.totalVideoFrames?f.totalVideoFrames:0;var h=g-c;c=g;g=f-d;d=f;isNaN(e)||(b[e]?(b[e].droppedVideoFrames+=h,b[e].totalVideoFrames+=g):b[e]={droppedVideoFrames:h,totalVideoFrames:g})},getFrameHistory:function(){return b},getFrameInfo:function(){return{droppedFrames:c,totalFrames:d}},reset:function(e){b=[];c=e.droppedVideoFrames;d=e.totalVideoFrames}}}function Q(b){function c(b,\nc,d,e){var f=Math.pow(.5,d/e.fast);b.fastEstimate=(1-f)*c+f*b.fastEstimate;e=Math.pow(.5,d/e.slow);b.slowEstimate=(1-e)*c+e*b.slowEstimate;b.totalWeight+=d}function d(b,c,d){return h.getMovingAverageMethod()!==G.MOVING_AVERAGE_SLIDING_WINDOW?function(b,c){var d=b?n.throughputHalfLife:n.latencyHalfLife,e=b?k[c]:q[c];if(!e||0>=e.totalWeight)return NaN;c=e.fastEstimate/(1-Math.pow(.5,e.totalWeight/d.fast));d=e.slowEstimate/(1-Math.pow(.5,e.totalWeight/d.slow));return b?Math.min(c,d):Math.max(c,d)}(b,\nc):function(b,c,d){d=function(b,c,d){var e=void 0,f=void 0;if(b?(e=l[c],f=d?3:4):(e=m[c],f=4),e)if(f>=e.length)f=e.length;else{if(b)for(b=1;b<f&&(c=e[b]/e[b-1],!(1.3<=c||c<=1/1.3)||(f+=1)!==e.length);++b);}else f=0;return f}(b,c,d);b=(b?l:m)[c];return 0!==d&&b&&0!==b.length?(b=b.slice(-d)).reduce(function(b,c){return b+c})/b.length:NaN}(b,c,d)}function e(b,c){return d(!0,b,c)}function f(b){l[b]=l[b]||[];m[b]=m[b]||[];k[b]=k[b]||{fastEstimate:0,slowEstimate:0,totalWeight:0};q[b]=q[b]||{fastEstimate:0,\nslowEstimate:0,totalWeight:0}}function g(){l={};m={};k={};q={}}var h=(b=b||{}).mediaPlayerModel,l=void 0,m=void 0,k=void 0,q=void 0,n=void 0;b={push:function(b,d,e){if(d.trace&&d.trace.length){!1;e=d.tresponse.getTime()-d.trequest.getTime()||1;var g=d._tfinish.getTime()-d.tresponse.getTime()||1;d=d.trace.reduce(function(b,c){return b+c.b[0]},0);var t=Math.round(8*d/(e+g));if(!(1E4>d)){if(f(b),function(b,c,d){return b===G.VIDEO?d+c<h.getCacheLoadThresholdForType(G.VIDEO):b===G.AUDIO?d+c<h.getCacheLoadThresholdForType(G.AUDIO):\nvoid 0}(b,e,g)){if(0<l[b].length&&!l[b].hasCachedEntries)return;l[b].hasCachedEntries=!0}else l[b]&&l[b].hasCachedEntries&&function(b){delete l[b];delete m[b];delete k[b];delete q[b];f(b)}(b);l[b].push(t);5<l[b].length&&l[b].shift();m[b].push(e);5<m[b].length&&m[b].shift();c(k[b],t,.001*g,n.throughputHalfLife);c(q[b],e,1,n.latencyHalfLife)}}},getAverageThroughput:e,getSafeAverageThroughput:function(b,c){b=e(b,c);return isNaN(b)||(b*=h.getBandwidthSafetyFactor()),b},getAverageLatency:function(b){return d(!1,\nb)},getDict:function(b){return{throughput:l[b],latency:m[b]}},reset:g};return n={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},g(),b}function W(){function b(b){b||(S={video:!0,audio:!0});Ga={};P={};ra={};L={};Qa={};Z={};V={};J={};Ma=!1;Q=!0;C=!1;void 0===H&&(H=!1);ia=ja=X=void 0;clearTimeout(Ta);Ta=null}function c(b){b.mediaType===G.VIDEO&&(X=b.oldQuality,ja.push(X,N.getPlaybackQuality()))}function d(b){b.metric!==za.HTTP_REQUEST||!b.value||b.value.type!==da.MEDIA_SEGMENT_TYPE||\nb.mediaType!==G.AUDIO&&b.mediaType!==G.VIDEO||ia.push(b.mediaType,b.value,Q);if(b.metric===za.BUFFER_LEVEL&&(b.mediaType===G.AUDIO||b.mediaType===G.VIDEO)){var c=b.mediaType;b=.001*b.value.level;var d=U.getABRStrategy();if(d===G.ABR_STRATEGY_BOLA)J[c]=!0;else if(d===G.ABR_STRATEGY_THROUGHPUT)J[c]=!1;else{var e=U.getStableBufferTime(),d=J[c],e=b>(d?.5*e:e);J[c]=e;e!==d&&w(e?\"AbrController (\"+c+\") switching from throughput to buffer occupancy ABR rule (buffer: \"+b.toFixed(3)+\").\":\"AbrController (\"+\nc+\") switching from buffer occupancy to throughput ABR rule (buffer: \"+b.toFixed(3)+\").\")}}}function e(b,c){return Ga[c]=Ga[c]||{},Ga[c].hasOwnProperty(b)||(Ga[c][b]=0),function(b,c){if(c!==G.VIDEO||!Ma||!Z[c])return b;H||pa();var d=B.getValue();c=fa.getAdaptationForType(d,0,c).Representation;d=b;if(0<M&&0<ca){for(;0<d&&c[d]&&M<c[d].width&&M-c[d-1].width<c[d].width-M;)--d;c.length-2>=d&&c[d].width===c[d+1].width&&(d=Math.min(b,d+1))}return d}(function(b,c,d){c=k(c);return isNaN(c)||1<=c||0>c?b:Math.min(b,\nMath.round(d*c))}(function(b,c){var d=b;if(!Z[c])return d;var e=m(c);void 0!==e&&(d=Math.max(b,e));b=h(c);void 0!==b&&(d=Math.min(d,b));return d}(Ga[c][b],b),b,Ga[c][b]),b)}function f(b){return ra.hasOwnProperty(\"max\")&&ra.max.hasOwnProperty(b)?ra.max[b]:NaN}function g(b){return ra.hasOwnProperty(\"min\")&&ra.min.hasOwnProperty(b)?ra.min[b]:NaN}function h(b){var c=f(b);return c?t(Z[b].getMediaInfo(),c):void 0}function m(b){var c=g(b);if(c){var d=p(Z[b].getMediaInfo());b=t(Z[b].getMediaInfo(),c);return d[b]&&\nb<d.length-1&&d[b].bitrate<1E3*c&&b++,b}}function k(b){return L.hasOwnProperty(\"max\")&&L.max.hasOwnProperty(b)?L.max[b]:1}function q(b,c,d,f){var g=c.id;c=u(b);if(null===d||isNaN(d)||0!=d%1)throw Error(\"argument is not an integer\");g=e(b,g);d!==c&&0<=d&&d<=g&&n(b,c,d,g,f)}function n(b,c,d,e,f){if(b&&Z[b]){var g=Z[b].getStreamInfo(),h=g?g.id:null;if(D.getLogToBrowserConsole()){var l=ba.getCurrentBufferLevel(K.getReadOnlyMetricsFor(b));w(\"AbrController (\"+b+\") switch from \"+c+\" to \"+d+\"/\"+e+\" (buffer: \"+\nl+\") \"+(f?JSON.stringify(f):\".\"))}P[h]=P[h]||{};P[h][b]=d;!0;v.trigger(x.QUALITY_CHANGE_REQUESTED,{mediaType:b,streamInfo:g,oldQuality:c,newQuality:d,reason:f})}}function t(b,c,d){if(Q&&d&&Z[b.type].getCurrentRepresentationInfo()&&Z[b.type].getCurrentRepresentationInfo().fragmentDuration){d/=1E3;var e=Z[b.type].getCurrentRepresentationInfo().fragmentDuration;if(d>e)return 0;c*=1-d/e}b=p(b);if(!b||0===b.length)return 0;for(d=b.length-1;0<=d;d--)if(1E3*c>=b[d].bitrate)return d;return 0}function p(b){if(!b||\n!b.bitrateList)return null;var c=b.bitrateList;b=b.type;for(var d=[],e,f=0,g=c.length;f<g;f++)(e=new Jd).mediaType=b,e.qualityIndex=f,e.id=c[f].id,e.bitrate=c[f].bandwidth,e.width=c[f].width,e.height=c[f].height,e.scanType=c[f].scanType,d.push(e);return d}function u(b){if(b&&Z[b]){var c=Z[b].getStreamInfo();if(c=c?c.id:null)return P[c]=P[c]||{},P[c].hasOwnProperty(b)||(P[c][b]=ea(b,!1)||0),P[c][b]}return 0}function pa(){if(N){var b=C&&window.hasOwnProperty(\"devicePixelRatio\")?window.devicePixelRatio:\n1;M=N.getClientWidth()*b;ca=N.getClientHeight()*b}}function z(b){var c=b.request.mediaType;if(S[c]){var d=Z[c];if(d){var e=cd(Ba).create({abrController:y,streamProcessor:d,currentRequest:b.request,useBufferOccupancyABR:J[c]}),e=A.shouldAbandonFragment(e);e.quality>ha.NO_CHANGE&&(d=d.getFragmentModel(),d.getRequests({state:pb.FRAGMENT_MODEL_LOADING,index:b.request.index})[0]&&(d.abortRequests(),Qa[c].state=\"abandonload\",V[c].reset(),V[c].push({oldValue:u(c,ac.getActiveStreamInfo()),newValue:e.quality,\nconfidence:1,reason:e.reason}),q(c,ac.getActiveStreamInfo(),e.quality,e.reason),clearTimeout(Ta),Ta=setTimeout(function(){Qa[c].state=\"allowload\";Ta=null},U.getAbandonLoadTimeout())))}}}function ea(b){if(!(1<arguments.length&&void 0!==arguments[1])||arguments[1]){var c=U.getPreloadData();if(c&&c[b+\"id\"])return Z[b].getRepresentationController().getQualityForRepresentationId(c[b+\"id\"])}return T[b]||0}var Ba=this.context,D=Ja(Ba).getInstance(),v=l(Ba).getInstance(),y=void 0,w=void 0,A=void 0,ac=void 0,\nS=void 0,Ga=void 0,P=void 0,ra=void 0,L=void 0,Z=void 0,Qa=void 0,Ta=void 0,Ma=void 0,C=void 0,H=void 0,M=void 0,ca=void 0,B=void 0,fa=void 0,I=void 0,N=void 0,U=void 0,aa=void 0,X=void 0,V=void 0,ja=void 0,ia=void 0,J=void 0,K=void 0,ba=void 0,Q=void 0,E=void 0,T={video:0,audio:0},W={video:{},audio:{}};return y={isPlayingAtTopQuality:function(b){b=b.id;var c=u(G.AUDIO),d=u(G.VIDEO);return c===e(G.AUDIO,b)&&d===e(G.VIDEO,b)},updateTopQualityIndex:function(b){var c=b.representationCount-1,d=b.type;\nb=b.streamInfo.id;Ga[b]=Ga[b]||{};return Ga[b][d]=c},getThroughputHistory:function(){return ia},getBitrateList:p,getQualityForBitrate:t,getMaxAllowedBitrateFor:f,getTopBitrateInfoFor:function(b){if(b&&Z&&Z[b]){var c=Z[b].getStreamInfo();if(c.id)return c=e(b,c.id),b=p(Z[b].getMediaInfo()),b[c]?b[c]:null}return null},getMinAllowedBitrateFor:g,setMaxAllowedBitrateFor:function(b,c){ra.max=ra.max||{};ra.max[b]=c},setMinAllowedBitrateFor:function(b,c){ra.min=ra.min||{};ra.min[b]=c},getMaxAllowedIndexFor:h,\ngetMinAllowedIndexFor:m,getMaxAllowedRepresentationRatioFor:k,setMaxAllowedRepresentationRatioFor:function(b,c){L.max=L.max||{};L.max[b]=c},getInitialBitrateFor:function(b){var c=aa.getSavedBitrateSettings(b);ra.hasOwnProperty(b)||(L.hasOwnProperty(b)?(c=B.getValue(),c=fa.getAdaptationForType(c,0,b).Representation,Array.isArray(c)?ra[b]=c[Math.max(Math.round(c.length*L[b])-1,0)].bandwidth:ra[b]=0):isNaN(c)?ra[b]=b===G.VIDEO?1E3:100:ra[b]=c);return ra[b]},setInitialBitrateFor:function(b,c){ra[b]=c},\ngetInitialRepresentationRatioFor:function(b){return L.hasOwnProperty(b)?L[b]:null},setInitialRepresentationRatioFor:function(b,c){L[b]=c},setAutoSwitchBitrateFor:function(b,c){S[b]=c},getAutoSwitchBitrateFor:function(b){return S[b]},getUseDeadTimeLatency:function(){return Q},setUseDeadTimeLatency:function(b){Q=b},setLimitBitrateByPortal:function(b){Ma=b},getLimitBitrateByPortal:function(){return Ma},getUsePixelRatioInLimitBitrateByPortal:function(){return C},setUsePixelRatioInLimitBitrateByPortal:function(b){C=\nb},getQualityFor:u,getAbandonmentStateFor:function(b){return Qa[b]?Qa[b].state:null},setPlaybackQuality:q,checkPlaybackQuality:function(b){if(b&&Z&&Z[b]){var c=Z[b].getStreamInfo(),d=c?c.id:null,c=u(b),f=cd(Ba).create({abrController:y,streamProcessor:Z[b],currentValue:c,switchHistory:V[b],droppedFramesHistory:ja,useBufferOccupancyABR:J[b]});if(ja){var g=N.getPlaybackQuality();g&&ja.push(X,g)}if(S[b]){var g=m(b),d=e(b,d),f=A.getMaxQuality(f),h=f.quality;(void 0!==g&&h<g&&(h=g),h>d&&(h=d),V[b].push({oldValue:c,\nnewValue:h}),h>ha.NO_CHANGE&&h!=c)?\"allowload\"!==Qa[b].state&&h===c||n(b,c,h,d,f.reason):D.getLogToBrowserConsole()&&(g=ba.getCurrentBufferLevel(K.getReadOnlyMetricsFor(b)),w(\"AbrController (\"+b+\") stay on \"+c+\"/\"+d+\" (buffer: \"+g+\")\"))}}},getTopQualityIndexFor:e,setElementSize:pa,setWindowResizeEventCalled:function(b){H=b},createAbrRulesCollection:function(){(A=Hd(Ba).create({metricsModel:K,dashMetrics:ba,mediaPlayerModel:U,adapter:I})).initialize()},registerStreamType:function(b,e){V[b]=F(Ba).create();\nZ[b]=e;Qa[b]=Qa[b]||{};Qa[b].state=\"allowload\";J[b]=!1;v.on(x.LOADING_PROGRESS,z,this);b==G.VIDEO&&(v.on(x.QUALITY_CHANGE_RENDERED,c,this),ja=la(Ba).create(),pa());v.on(x.METRIC_ADDED,d,this);ia=Ad(Ba).create({mediaPlayerModel:U})},unRegisterStreamType:function(b){delete Z[b]},setDefaultQualityFor:function(b,c){T[b]=Number(c)||0;w(\"Set default quality for \"+b+\" - \"+T[b])},getDefaultQualityFor:ea,getDroppedFramesInfo:function(){return ja&&ja.getFrameInfo&&ja.getFrameInfo()||{}},setCurrentSegmentInfoFor:function(b,\nc){W[b]=c},getCurrentSegmentInfoFor:function(b){return W[b]},getInitializeDate:function(){return E},setConfig:function(b){b&&(b.streamController&&(ac=b.streamController),b.domStorage&&(aa=b.domStorage),b.mediaPlayerModel&&(U=b.mediaPlayerModel),b.metricsModel&&(K=b.metricsModel),b.dashMetrics&&(ba=b.dashMetrics),b.dashManifestModel&&(fa=b.dashManifestModel),b.adapter&&(I=b.adapter),b.manifestModel&&(B=b.manifestModel),b.videoModel&&(N=b.videoModel),b.initializeDate&&(E=b.initializeDate))},reset:function(){b(!0);\nv.off(x.LOADING_PROGRESS,z,this);v.off(x.QUALITY_CHANGE_RENDERED,c,this);v.off(x.METRIC_ADDED,d,this);A&&A.reset()}},w=D.log.bind(y),b(),y}function z(){function b(b,c){if(!b||!c)return[];c=c.id;return z[c]&&z[c][b]?z[c][b].list:[]}function c(b,c){return!b||!c||c&&!z[c.id]?null:z[c.id][b].current}function d(b){if(b){var d=b.type,e=b.streamInfo,f=e.id,e=c(d,e);!z[f]||!z[f][d]||e&&m(b,e)||(z[f][d].current=b,e&&pa.trigger(x.CURRENT_TRACK_CHANGED,{oldMediaInfo:e,newMediaInfo:b,switchMode:D[d]}),b={lang:b.lang,\nviewpoint:b.viewpoint,roles:b.roles,accessibility:b.accessibility,audioChannelConfiguration:b.audioChannelConfiguration},(b=b.lang||b.viewpoint||b.role&&0<b.role.length||b.accessibility&&0<b.accessibility.length||b.audioChannelConfiguration&&0<b.audioChannelConfiguration.length?b:null)&&z[f][d].storeLastSettings&&(b.roles&&(b.role=b.roles[0],delete b.roles),b.accessibility&&(b.accessibility=b.accessibility[0]),b.audioChannelConfiguration&&(b.audioChannelConfiguration=b.audioChannelConfiguration[0]),\nv.setSavedMediaSettings(d,b)))}}function e(b,c){b&&c&&(ea[b]=c)}function f(b){return b?ea[b]:null}function g(){return Ba||\"highestBitrate\"}function h(b){return b===G.AUDIO||b===G.VIDEO||b===G.TEXT||b===G.FRAGMENTED_TEXT||b===G.IMAGE}function m(b,c){var d=b.viewpoint===c.viewpoint,e=b.lang===c.lang,f=b.roles.toString()===c.roles.toString(),g=b.accessibility.toString()===c.accessibility.toString(),h=b.audioChannelConfiguration.toString()===c.audioChannelConfiguration.toString();return b.id===c.id&&\nd&&e&&f&&g&&h}function k(){z={};ea={audio:null,video:null};D={audio:\"alwaysReplace\",video:\"neverReplace\"}}function q(b,c){var d=!b.lang||b.lang===c.lang,e=!b.viewpoint||b.viewpoint===c.viewpoint,f=!b.role||!!c.roles.filter(function(c){return c===b.role})[0],g=!b.accessibility||!!c.accessibility.filter(function(c){return c===b.accessibility})[0];c=!b.audioChannelConfiguration||!!c.audioChannelConfiguration.filter(function(c){return c===b.audioChannelConfiguration})[0];return d&&e&&f&&g&&c}function n(b){var c=\ng(),d=[],e=function(b){var c=0,d=[],e=void 0;return b.forEach(function(b){(e=Math.max.apply(Math,b.bitrateList.map(function(b){return b.bandwidth})))>c?(c=e,d=[b]):e===c&&d.push(b)}),d},f=function(b){var c=0,d=[],e=void 0;return b.forEach(function(b){(e=b.representationCount)>c?(c=e,d=[b]):e===c&&d.push(b)}),d};switch(c){case \"highestBitrate\":1<(d=e(b)).length&&(d=f(d));break;case \"widestRange\":1<(d=f(b)).length&&(d=e(b));break;default:u(\"track selection mode is not supported: \"+c)}return d[0]}var t,\np=this.context,u=Ja(p).getInstance().log,pa=l(p).getInstance(),z=void 0,ea=void 0,Ba=void 0,D=void 0,v=void 0,y=[\"alwaysReplace\",\"neverReplace\"],w=[\"highestBitrate\",\"widestRange\"],A={video:0,audio:0};return t={checkInitialMediaSettingsForType:function(c,g){var h=f(c);g=b(c,g);var l=[];c!==G.FRAGMENTED_TEXT?(h||e(c,h=v.getSavedMediaSettings(c)),g&&0!==g.length&&(h&&g.forEach(function(b){q(h,b)&&l.push(b)}),0===l.length?d(n(g)):1<l.length?d(n(l)):d(l[0]))):d(g[0])},addTrack:function(b){if(b){var e=\nb.type;if(h(e)){var g=b.streamInfo.id;z[g]||(z[g]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var g=z[g][e].list,l=0,k=g.length;l<k;++l)if(m(g[l],b))return;g.push(b);(g=f(e))&&q(g,b)&&!c(e,b.streamInfo)&&d(b)}}},getTracksFor:b,getCurrentTrackFor:c,isCurrentTrack:function(b){var c=\nb.type,d=b.streamInfo.id;return z[d]&&z[d][c]&&m(z[d][c].current,b)},setTrack:d,setInitialSettings:e,getInitialSettings:f,setSwitchMode:function(b,c){-1!==y.indexOf(c)?D[b]=c:u(\"track switch mode is not supported: \"+c)},getSwitchMode:function(b){return D[b]},setSelectionModeForInitialTrack:function(b){-1!==w.indexOf(b)?Ba=b:u(\"track selection mode is not supported: \"+b)},getSelectionModeForInitialTrack:g,isMultiTrackSupportedByType:h,isTracksEqual:m,setStartOffsetTimeForType:function(b,c){b&&0<c&&\n(A[b]=c)},getStartOffsetTimeForType:function(b){return A[b]||0},setConfig:function(b){b&&(b.errHandler&&b.errHandler,b.domStorage&&(v=b.domStorage))},reset:k},k(),t}function M(){function b(b){var e=[];if(!b||!d||\"function\"!=typeof d.fetchAll)return e;b=d.fetchAll(b);for(var f=void 0,g=0,h=b.length;g<h;g++)(f=c(b[g]))&&e.push(f);return e}function c(b){if(!b)return null;var c=new wd(b);return b.hasOwnProperty(\"_incomplete\")&&(c.isComplete=!b._incomplete),c}var d=void 0;return{getBox:function(b){return b&&\nd&&d.boxes&&0!==d.boxes.length&&\"function\"==typeof d.fetch?c(d.fetch(b)):null},getBoxes:b,setData:function(b){d=b},getLastBox:function(){if(!d||!d.boxes||!d.boxes.length)return null;var c=b(d.boxes[d.boxes.length-1].type);return 0<c.length?c[c.length-1]:null}}}function I(){var b=this.context;return{parse:function(c){if(!c)return null;void 0===c.fileStart&&(c.fileStart=0);c=$c.a.parseBuffer(c);var d=xd(b).create();return d.setData(c),d},findLastTopIsoBoxCompleted:function(b,c,d){if(void 0===d&&(d=\n0),!c||d+8>=c.byteLength)return new Ec(0,!1);c=c instanceof ArrayBuffer?new Uint8Array(c):c;for(var e=void 0,f=0;d<c.byteLength;){var g=c[d+3]>>>0|c[d+2]<<8>>>0|c[d+1]<<16>>>0|c[d]<<24>>>0;var h=c;var l=d+4;h=String.fromCharCode(h[l++])+String.fromCharCode(h[l++])+String.fromCharCode(h[l++])+String.fromCharCode(h[l]);if(0===g)break;d+g<=c.byteLength&&(0<=b.indexOf(h)?e=new Ec(d,!0,g):f=d+g);d+=g}return e||new Ec(f,!1)}}}function N(){var b={};return{save:function(c){var d=c.streamId,e=c.representationId;\nb[d]=b[d]||{};b[d][e]=c},extract:function(c,d){return b&&b[c]&&b[c][d]?b[c][d]:null},reset:function(){b={}}}}function T(b){function c(b){if(!Ca||!b||!V)return null;if(T)try{\"function\"==typeof(qa=zd(H).create(T,b,h.bind(this))).getBuffer().initialize&&qa.getBuffer().initialize(X,V),M.trigger(x.BUFFER_CREATED,{mediaType:b.type})}catch(Ic){ia(\"Caught error on create SourceBuffer: \"+Ic),fa.mediaSourceError(\"Error creating \"+X+\" source buffer.\")}else qa=Kd(H).create(h.bind(this));P(V.getRepresentationInfoForQuality(J).MSETimeOffset)}\nfunction d(b){b.fragmentModel===V.getFragmentModel()&&(ia(\"Init fragment finished loading saving to\",X+\"'s init cache\"),ia(\"Append Init fragment\",X,\" with representationId:\",b.chunk.representationId,\" and quality:\",b.chunk.quality),qa?qa.setAppendWindowEnd(B.getCachedDurationOffset(\"duration\")):pc=function(){var b=B.getCachedDurationOffset(\"duration\");qa.setAppendWindowEnd(b)},f(b.chunk))}function e(b){if(b.fragmentModel===V.getFragmentModel()){b=b.chunk;var c=b.bytes,d=b.quality,e=V.getRepresentationInfoForQuality(d),\ng=U.getEventsFor(e.mediaInfo,V),h=U.getEventsFor(e,V);if(g&&0<g.length||h&&0<h.length){for(var d=V.getFragmentModel().getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,quality:d,index:b.index})[0],d=Math.max(!d||isNaN(d.startTime)?0:d.startTime,0),e=[],l=[],g=g.concat(h),h=0,m=g.length;h<m;h++)e[g[h].schemeIdUri]=g[h];c=Fc(H).getInstance().parse(c).getBoxes(\"emsg\");g=0;for(h=c.length;g<h;g++)(m=U.getEvent(c[g],e,d))&&l.push(m);V.getEventController().addInbandEvents(l)}va?(Aa=b,(b=qa&&qa.getAllBufferRanges())&&\n0<b.length&&.5<aa.getTimeToStreamEnd()&&(ia(\"Clearing buffer because track changed - \"+(b.end(b.length-1)+.5)),y([{start:0,end:b.end(b.length-1)+.5,force:!0}]))):f(b)}}function f(b,c){!R||c?(R=!0,bb=b,b.startOffsetTime=N.getStartOffsetTimeForType(b.mediaInfo.type),qa?qa.append(b):ka.push(b),b.mediaInfo.type===G.VIDEO&&M.trigger(x.VIDEO_CHUNK_RECEIVED,{chunk:b})):ha.push(b)}function g(b){if(b.mediaType===X&&(pc&&(pc(),pc=null),ka.length)){var c=Date.now();b=b.mediaType;for(var d=ba.getInitializeDate(),\ne=0;e<ka.length;e++){var f=ka[e];f&&f.mediaInfo.type===b&&qa&&qa.append&&(ka[e]=null,ga&&(P(ga),ga=0),qa.append(f),M.trigger(x.DELAY_TO_APPEND_TO_BUFFER,{mediaType:b,appendTime:c-d,createdTime:Date.now()-d,isPreload:!!B.getPreloadData()}))}}}function h(b){if(b.error){if(22===b.error.code&&(E=.8*Ta(),ia(\"Quota exceeded for type: \"+X+\", Critical Buffer: \"+E),0<E)){var c=Math.max(.2*E,1),d=E-c;B.setBufferToKeep(parseFloat(c).toFixed(5));B.setBufferAheadToKeep(parseFloat(d).toFixed(5))}22!==b.error.code&&\nTa()<E||(ia(\"Clearing playback buffer to overcome quota exceed situation for type: \"+X),M.trigger(x.QUOTA_EXCEEDED,{sender:ja,criticalBufferLevel:E,mediaType:X}),q(),R=!1)}else(bb=b.chunk)&&!isNaN(bb.index)&&(F=Math.max(bb.index,F),ea()),b=qa.getAllBufferRanges(),bb.segmentType===da.MEDIA_SEGMENT_TYPE?n():va&&(c=aa.getTime(),ia(\"[BufferController][\",X,\"] appendToBuffer seek target should be \"+c),V.getScheduleController().setSeekTarget(c),U.setIndexHandlerTime(V,c)),b={sender:ja,quality:bb.quality,\nstartTime:bb.start,index:bb.index,bufferedRanges:b},(bb&&!bb.endFragment?M.trigger(x.BYTES_APPENDED,b):bb&&M.trigger(x.BYTES_APPENDED_END_FRAGMENT,b),0===ha.length)?R=!1:f(ha.shift(),!0)}function m(b){J!==b.newQuality&&X===b.mediaType&&V.getStreamInfo().id===b.streamInfo.id&&(P(V.getRepresentationInfoForQuality(b.newQuality).MSETimeOffset),J=b.newQuality)}function k(){if(K&&(Ha=!0,K=!1,W=Number.POSITIVE_INFINITY),ha=[],R=!1,X!==G.FRAGMENTED_TEXT){var b=qa.getAllBufferRanges(),c=!0;if(b&&0<b.length)for(var d=\naa.getTime(),e=0,f=b.length;e<f;e++)d>=b.start(e)&&d<=b.end(e)-1&&(c=!1);c?(V.getFragmentModel().clearExecutedRequestBySeeking(),q()):n()}else n();oa=void 0}function q(){var b=[],c=qa.getAllBufferRanges();if(c&&0!==c.length){var d=aa.getTime(),e=c.end(c.length-1)+.5;if(d=V.getFragmentModel().getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:d,threshold:.01})[0]){var f={start:0,end:d.startTime-.5},g=V.getFragmentModel().getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:d.startTime-d.duration/2,threshold:.01})[0];\ng&&g.startTime!=d.startTime&&(f.end=g.startTime);f.start<f.end&&f.end>c.start(0)&&b.push(f);c={start:d.startTime+d.duration+.5,end:e};(f=V.getFragmentModel().getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:d.startTime+d.duration+.5,threshold:.01})[0])&&f.startTime!==d.startTime&&(c.start=f.startTime+f.duration+.5);c.start<c.end&&c.start<e&&b.push(c)}else ia(\"getAllRangesWithSafetyFactor for\",X,\"- No request found in current time position, removing full buffer 0 -\",e),b.push({start:0,end:e})}b&&\n0!==b.length||n();y(b)}function n(){va||(pa(),z())}function t(){Ea()}function p(){Ea()}function u(b,c){var d=qa&&qa.getAllBufferRanges(),e,f=null,g=null,h,l=c||.15;if(null!=d){var m=0;for(h=d.length;m<h;m++)if(c=d.start(m),e=d.end(m),null===f){var k=Math.abs(c-b);(b>=c&&b<e||k<=l)&&(f=c,g=e)}else{if(!(c-g<=l))break;g=e}if(null!==f)return{start:f,end:g}}return null}function pa(){var b;if(aa){var c=aa.getTime();if(oa){var d=qa.getAllBufferRanges();d&&d.length&&(c=Math.max(d.start(0),oa))}c=c||0;Q=null===\n(b=u(c,void 0))?0:b.end-c;M.trigger(x.BUFFER_LEVEL_UPDATED,{sender:ja,bufferLevel:Q});Ea()}}function z(){V&&I&&V.getStreamInfo().id===I.getActiveStreamInfo().id&&(ca.addBufferState(X,O,V.getScheduleController().getBufferTarget()),ca.addBufferLevel(X,new Date,1E3*Q))}function ea(){F>=W-1&&!K&&void 0===qa.discharge&&(K=!0,ia(\"[BufferController][\"+X+\"] checkIfBufferingCompleted trigger BUFFERING_COMPLETED\"),M.trigger(x.BUFFERING_COMPLETED,{sender:ja,streamInfo:V.getStreamInfo()}))}function Ea(){\"audio\"!==\nX&&\"video\"!==X||(Ha&&!K&&aa&&.5>aa.getTimeToStreamEnd()-Q&&(Ha=!1,K=!0,ia(\"[BufferController][\"+X+\"] checkIfSufficientBuffer trigger BUFFERING_COMPLETED\"),M.trigger(x.BUFFERING_COMPLETED,{sender:ja,streamInfo:V.getStreamInfo()})),.5>Q&&!K?D(\"bufferStalled\"):(K||Q>=B.getStableBufferTime())&&D(\"bufferLoaded\"))}function D(b){O===b||\"bufferStalled\"===b&&0===aa.getTime()||(O=b,z(),M.trigger(x.BUFFER_LEVEL_STATE_CHANGED,{sender:ja,state:b,mediaType:X,streamInfo:V.getStreamInfo()}),M.trigger(\"bufferLoaded\"===\nb?x.BUFFER_LOADED:x.BUFFER_EMPTY,{mediaType:X}),ia(\"bufferLoaded\"===b?\"Got enough buffer to start for \"+X:\"Waiting for more buffer before starting playback for \"+X))}function v(){qa&&X!==G.FRAGMENTED_TEXT&&(K||y(function(){var b=[],c=qa.getAllBufferRanges();if(!c||0===c.length)return b;var d=aa.getTime(),e=Math.max(0,d-B.getBufferToKeep()),f=d+B.getBufferAheadToKeep(),g=V.getFragmentModel().getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:d,threshold:.01})[0];if(g)e=Math.min(g.startTime,e),f=Math.max(g.startTime+\ng.duration,f);else if(0===d&&aa.getIsDynamic())return[];if(c.start(0)<=e){d={start:0,end:e};for(g=0;g<c.length&&c.end(g)<=e;g++)d.end=c.end(g);d.start<d.end&&b.push(d)}c.end(c.length-1)>=f&&(c={start:f,end:c.end(c.length-1)+.01},c.start<c.end&&b.push(c));return b}()))}function y(b){b&&qa&&0!==b.length&&(la.push.apply(la,b),ma||w())}function w(){if(0===la.length||!qa)return ia(\"Nothing to prune, halt pruning\"),la=[],void(ma=!1);var b=qa.getBuffer();if(!b||!b.buffered||0===b.buffered.length)return ia(\"SourceBuffer is empty (or does not exist), halt pruning\"),\nla=[],void(ma=!1);b=la.shift();ia(\"Removing\",X,\"buffer from:\",b.start,\"to\",b.end);ma=!0;var c=aa.getTime();c<b.end&&(K=!1,F=0,va||(V.getScheduleController().setSeekTarget(c),U.setIndexHandlerTime(V,c)));(c=I.getDuration()-1)&&0===b.start&&b.end>=c&&(b.force=!0);qa.remove(b.start,b.end,b.force)}function A(b){qa===b.buffer&&(ia(\"[BufferController][\",X,\"] onRemoved buffer from:\",b.from,\"to\",b.to),0===la.length&&(ma=!1),b.unintended&&(ia(\"[BufferController][\",X,\"] detected unintended removal from:\",b.from,\n\"to\",b.to,\"setting index handler time to\",b.from),U.setIndexHandlerTime(V,b.from)),ma?w():(va?(va=!1,Aa&&f(Aa)):(ia(\"onRemoved : call updateBufferLevel\"),pa()),M.trigger(x.BUFFER_CLEARED,{sender:ja,from:b.from,to:b.to,unintended:b.unintended,hasEnoughSpaceToAppend:Ta()<E})))}function P(b){0!==b&&(qa&&qa.updateTimestampOffset?qa.updateTimestampOffset(b):ga=b)}function S(b){if(b.sender.getStreamProcessor()===V&&!b.error){var c=0;try{c=b.currentRepresentation.segmentAvailabilityRange.start}catch(ed){}P(c)}}\nfunction Ga(b){b.fragmentModel===V.getFragmentModel()&&(W=b.request.index,ea())}function C(b){var c=qa&&qa.getAllBufferRanges();c&&b.newMediaInfo.type===X&&b.newMediaInfo.streamInfo.id===V.getStreamInfo().id&&(ia(\"[BufferController][\"+X+\"] track change asked\"),N.getSwitchMode(X)===ec.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&c&&0<c.length&&.5<aa.getTimeToStreamEnd()&&(K=!1,W=Number.POSITIVE_INFINITY))}function ra(){++Y*(B.getWallclockTimeUpdateInterval()/1E3)>=B.getBufferPruningInterval()&&(Y=0,v())}function L(){Ea()}\nfunction Z(){if(B.getAppendingSourceState()){K=!1;W=Number.POSITIVE_INFINITY;Ca.reset();var b=B.getCachedDurationOffset(\"offset\");U.setIndexHandlerTime(V,b);V.resetPreloadData();V.getFragmentModel().resetInitialSettings()}}function Qa(b,d){T=b;qa&&d&&\"function\"==typeof qa.discharge&&(sa=qa,c(d))}function Ta(){var b,c=qa.getAllBufferRanges(),d=0;if(!c)return d;var e=0;for(b=c.length;e<b;e++)d+=c.end(e)-c.start(e);return d}function Ma(b){E=Number.POSITIVE_INFINITY;O=void 0;J=$b.QUALITY_DEFAULT;W=Number.POSITIVE_INFINITY;\nF=0;bb=null;Ha=ma=R=K=!1;Y=Q=0;la=[];ka=[];qa&&(b||qa.abort(),qa.reset(),qa=null);va=!1}b=b||{};var H=this.context,M=l(H).getInstance(),ca=b.metricsModel,B=b.mediaPlayerModel,fa=b.errHandler,I=b.streamController,N=b.mediaController,U=b.adapter,ba=b.abrController,aa=b.playbackController,X=b.type,V=b.streamProcessor,ja=void 0,ia=void 0,J=void 0,K=void 0,Q=void 0,E=void 0,T=void 0,F=void 0,W=void 0,qa=void 0,sa=void 0,O=void 0,bb=void 0,Y=void 0,R=void 0,ma=void 0,Ca=void 0,oa=void 0,Ha=void 0,la=void 0,\nha=void 0,va=void 0,Aa=void 0,ka=void 0,ga=void 0,qc=void 0,pc=void 0;return ja={getBufferControllerType:function(){return\"BufferController\"},initialize:function(b){0;Qa(b);J=ba.getQualityFor(X,V.getStreamInfo());M.on(x.DATA_UPDATE_COMPLETED,S,this);M.on(x.INIT_FRAGMENT_LOADED,d,this);M.on(x.MEDIA_FRAGMENT_LOADED,e,this);M.on(x.QUALITY_CHANGE_REQUESTED,m,this);M.on(x.STREAM_COMPLETED,Ga,this);M.on(x.PLAYBACK_PLAYING,p,this);M.on(x.PLAYBACK_PROGRESS,n,this);M.on(x.PLAYBACK_TIME_UPDATED,n,this);M.on(x.PLAYBACK_RATE_CHANGED,\nL,this);M.on(x.PLAYBACK_SEEKING,k,this);M.on(x.PLAYBACK_STALLED,t,this);M.on(x.WALLCLOCK_TIME_UPDATED,ra,this);M.on(x.CURRENT_TRACK_CHANGED,C,this,l.EVENT_PRIORITY_HIGH);M.on(x.SOURCEBUFFER_REMOVE_COMPLETED,A,this);M.on(x.BUFFER_CREATED,g,this);M.on(x.APPENDING_NEXT_SOURCE,Z,this)},createBuffer:c,dischargePreBuffer:function(){if(qa&&sa&&\"function\"==typeof sa.discharge){var b=sa.getAllBufferRanges();if(0<b.length){for(var c=\"Beginning \"+X+\"PreBuffer discharge, adding buffer for:\",d=0;d<b.length;d++)c+=\n\" start: \"+b.start(d)+\", end: \"+b.end(d)+\";\";ia(c)}else ia(\"PreBuffer discharge requested, but there were no media segments in the PreBuffer.\");b=sa.discharge();c=null;for(d=0;d<b.length;d++){var e=b[d],f=Ca.extract(e.streamId,e.representationId);f&&(c!==f&&(qa.append(f),c=f),qa.append(e))}sa.reset();sa=null}},getType:function(){return X},getStreamProcessor:function(){return V},setSeekStartTime:function(b){oa=b},getBuffer:function(){return qa},getBufferLevel:function(){return Q},getRangeAt:u,setMediaSource:Qa,\ngetMediaSource:function(){return T},getIsBufferingCompleted:function(){return K},switchInitData:function(b,c,d){b=Ca.extract(b,c);va=!0===d&&d;qc=B.getAppendingSourceState();b&&!qc?(ia(\"Append Init fragment\",X,\" with representationId:\",b.representationId,\" and quality:\",b.quality),f(b)):(qc&&(qc=!1,va=!1),M.trigger(x.INIT_REQUESTED,{sender:ja}))},getIsPruningInProgress:function(){return ma},reset:function(b){M.off(x.DATA_UPDATE_COMPLETED,S,this);M.off(x.QUALITY_CHANGE_REQUESTED,m,this);M.off(x.INIT_FRAGMENT_LOADED,\nd,this);M.off(x.MEDIA_FRAGMENT_LOADED,e,this);M.off(x.STREAM_COMPLETED,Ga,this);M.off(x.CURRENT_TRACK_CHANGED,C,this);M.off(x.PLAYBACK_PLAYING,p,this);M.off(x.PLAYBACK_PROGRESS,n,this);M.off(x.PLAYBACK_TIME_UPDATED,n,this);M.off(x.PLAYBACK_RATE_CHANGED,L,this);M.off(x.PLAYBACK_SEEKING,k,this);M.off(x.PLAYBACK_STALLED,t,this);M.off(x.WALLCLOCK_TIME_UPDATED,ra,this);M.off(x.SOURCEBUFFER_REMOVE_COMPLETED,A,this);M.off(x.BUFFER_CREATED,g,this);M.off(x.APPENDING_NEXT_SOURCE,Z,this);Ma(b)}},ia=Ja(H).getInstance().log.bind(ja),\nCa=bd(H).getInstance(),ha=[],ka=[],ga=0,Ma(),ja}function ma(){var b=void 0;return{initialize:function(c){if(b=new Bd,!c)return null;var d=c.indexOf(\"#\");if(-1!==d){c=c.substr(d+1).split(\"&\");for(var d=0,e=c.length;d<e;++d){var f=c[d],g=f.indexOf(\"=\");if(-1!==g){var h=f.substring(0,g);b.hasOwnProperty(h)&&(b[h]=f.substr(g+1))}}}},getURIFragmentData:function(){return b}}}function ga(){function b(b){!Q&&b.fromStreamInfo&&void 0!==ja[b.fromStreamInfo.id]&&(delete J[b.fromStreamInfo.id],delete ja[b.fromStreamInfo.id])}\nfunction c(){var b=p(!0);return parseFloat((b+(K.duration-(Q?b-K.start:0))-m()).toFixed(5))}function d(){K&&aa&&aa.getElement()?aa.play():T=!0}function e(){return K&&aa?aa.isPaused():null}function f(){K&&aa&&aa.pause()}function g(){return K&&aa?aa.isSeeking():null}function h(b){K&&aa&&(B.trigger(x.PLAYBACK_SEEK_ASKED),H(\"Requesting seek to time: \"+b),aa.setCurrentTime(b))}function m(){return K&&aa?aa.getTime():null}function k(){return K&&aa?aa.getPlaybackRate():null}function q(){return K&&aa?aa.getEnded():\nnull}function n(){0;X=NaN;V=null;T=!1;ja={};F=ia=0;J={};aa&&(B.off(x.DATA_UPDATE_COMPLETED,z,this),B.off(x.BUFFER_LEVEL_STATE_CHANGED,Qa,this),B.off(x.BYTES_APPENDED_END_FRAGMENT,Z,this),B.off(x.PERIOD_SWITCH_STARTED,b,this),clearInterval(V),V=null,aa.removeEventListener(\"canplay\",ea),aa.removeEventListener(\"play\",Ba),aa.removeEventListener(\"waiting\",D),aa.removeEventListener(\"playing\",v),aa.removeEventListener(\"pause\",y),aa.removeEventListener(\"error\",L),aa.removeEventListener(\"seeking\",w),aa.removeEventListener(\"seeked\",\nA),aa.removeEventListener(\"timeupdate\",M),aa.removeEventListener(\"progress\",S),aa.removeEventListener(\"ratechange\",Ga),aa.removeEventListener(\"loadedmetadata\",P),aa.removeEventListener(\"ended\",ra),aa.removeEventListener(\"stalled\",Ta));Q=K=aa=null}function t(){var b=Pb(C).getInstance().getURIFragmentData(),c=void 0;if(b){var c={},d=parseInt(b.r,10);0<=d&&K&&d<K.manifestInfo.DVRWindowSize&&null===b.t&&(b.t=Math.floor(Date.now()/1E3)-K.manifestInfo.DVRWindowSize+d);c.fragS=parseInt(b.s,10);c.fragT=parseInt(b.t,\n10)}return c}function p(b,c){var d=void 0,e=t();(b=e?b?K.start:isNaN(e.fragS)?e.fragT:e.fragS:0,Q)?(isNaN(b)||((d=b-K.manifestInfo.availableFrom.getTime()/1E3)>X||d<(isNaN(c)?NaN:c-K.manifestInfo.DVRWindowSize))&&(d=null),d=d||X):!isNaN(b)&&b<Math.max(K.manifestInfo.duration,K.duration)&&0<=b?d=b:(c=ja[K.id],d=void 0!==c?Math.max(void 0!==c.audio?c.audio:0,void 0!==c.video?c.video:0,K.start):K.start);return d}function u(){null===V&&(V=setInterval(function(){var b;B.trigger(x.WALLCLOCK_TIME_UPDATED,\n{isDynamic:Q,time:new Date});Q&&e()&&(b=Date.now(),(!W||b>W+500)&&(W=b,M()))},E.getWallclockTimeUpdateInterval()))}function pa(){if(!e()&&Q&&0!==aa.getReadyState()){var b=m();var c=I.getReadOnlyMetricsFor(G.VIDEO)||I.getReadOnlyMetricsFor(G.AUDIO);c=(c=(c=fa.getCurrentDVRInfo(c))?c.range:null)?b>c.end?Math.max(c.end-2*K.manifestInfo.minBufferTime,c.start):b+.25<c.start?c.start:b:NaN;!isNaN(c)&&c!==b&&h(c)}}function z(b){b.error||(b=ba.convertDataToRepresentationInfo(b.currentRepresentation).mediaInfo.streamInfo,\nK.id===b.id&&(K=b,pa()))}function ea(){B.trigger(x.CAN_PLAY)}function Ba(){H(\"Native video element event: play\");pa();u();B.trigger(x.PLAYBACK_STARTED,{startTime:m()})}function D(){H(\"Native video element event: waiting\");B.trigger(x.PLAYBACK_WAITING,{playingTime:m()})}function v(){H(\"Native video element event: playing\");B.trigger(x.PLAYBACK_PLAYING,{playingTime:m()})}function y(){H(\"Native video element event: pause\");B.trigger(x.PLAYBACK_PAUSED,{ended:q()})}function w(){var b=m();H(\"Seeking to: \"+\nb);u();B.trigger(x.PLAYBACK_SEEKING,{seekTime:b})}function A(){H(\"Native video element event: seeked\");B.trigger(x.PLAYBACK_SEEKED)}function M(){var b=m();b;B.trigger(x.PLAYBACK_TIME_UPDATED,{timeToEnd:c(),time:b})}function S(){B.trigger(x.PLAYBACK_PROGRESS)}function Ga(){var b=k();H(\"Native video element event: ratechange: \",b);B.trigger(x.PLAYBACK_RATE_CHANGED,{playbackRate:b})}function P(){H(\"Native video element event: loadedmetadata\");B.trigger(x.PLAYBACK_METADATA_LOADED);u()}function ra(){H(\"Native video element event: ended\");\nf();clearInterval(V);V=null;B.trigger(x.PLAYBACK_ENDED,{isNativeEnded:!0})}function L(b){B.trigger(x.PLAYBACK_ERROR,{error:(b.target||b.srcElement).error})}function Z(b){var c=void 0,d=b.bufferedRanges;if(d&&d.length&&(!ja[K.id]||!0!==ja[K.id].started)){var e=b.sender.getType();void 0===J[K.id]&&(J[K.id]=[]);J[K.id][e]=d;void 0===ja[K.id]&&(ja[K.id]=[],ja[K.id].started=!1);void 0===ja[K.id][e]&&(ja[K.id][e]=Math.max(d.start(0),K.start));var f=ca.isVideoTrackPresent(),l=ca.isAudioTrackPresent();b=\np(!1);if(l&&f){if(!isNaN(ja[K.id].audio)&&!isNaN(ja[K.id].video)){ja[K.id].audio<ja[K.id].video?(c=ja[K.id].video>b?ja[K.id].video:b,d=J[K.id].audio):(c=ja[K.id].audio>b?ja[K.id].audio:b,d=J[K.id].video);a:{b=c;if(d&&0<d.length)for(e=0,f=d.length;e<f;e++)if(b>=d.start(e)&&b<d.end(e)){d=!0;break a}d=!1}d&&(g()||0===c||h(c),ja[K.id].started=!0)}}else ja[K.id][e]&&(c=ja[K.id][e]>b?ja[K.id][e]:b,g()||h(c),ja[K.id].started=!0)}}function Qa(b){b.streamInfo.id===K.id&&aa.setStallState(b.mediaType,b.state===\nic.BUFFER_EMPTY)}function Ta(b){H(\"Native video element event: stalled\",b);B.trigger(x.PLAYBACK_STALLED,{e:b})}var Ma,C=this.context,H=Ja(C).getInstance().log,B=l(C).getInstance(),ca=void 0,I=void 0,fa=void 0,U=void 0,N=void 0,ba=void 0,aa=void 0,X=void 0,V=void 0,ja=void 0,ia=void 0,J=void 0,K=void 0,Q=void 0,E=void 0,T=void 0,W=void 0,F=void 0;return Ma={initialize:function(c){K=c;aa.addEventListener(\"canplay\",ea);aa.addEventListener(\"play\",Ba);aa.addEventListener(\"waiting\",D);aa.addEventListener(\"playing\",\nv);aa.addEventListener(\"pause\",y);aa.addEventListener(\"error\",L);aa.addEventListener(\"seeking\",w);aa.addEventListener(\"seeked\",A);aa.addEventListener(\"timeupdate\",M);aa.addEventListener(\"progress\",S);aa.addEventListener(\"ratechange\",Ga);aa.addEventListener(\"loadedmetadata\",P);aa.addEventListener(\"ended\",ra);aa.addEventListener(\"stalled\",Ta);Q=K.manifestInfo.isDynamic;X=K.start;B.on(x.DATA_UPDATE_COMPLETED,z,this);B.on(x.BYTES_APPENDED_END_FRAGMENT,Z,this);B.on(x.BUFFER_LEVEL_STATE_CHANGED,Qa,this);\nB.on(x.PERIOD_SWITCH_STARTED,b,this);T&&(T=!1,d())},setConfig:function(b){b&&(b.streamController&&(ca=b.streamController),b.metricsModel&&(I=b.metricsModel),b.dashMetrics&&(fa=b.dashMetrics),b.manifestModel&&(U=b.manifestModel),b.dashManifestModel&&(N=b.dashManifestModel),b.mediaPlayerModel&&(E=b.mediaPlayerModel),b.adapter&&(ba=b.adapter),b.videoModel&&(aa=b.videoModel))},getStartTimeFromUriParameters:t,getStreamStartTime:p,getTimeToStreamEnd:c,getTime:m,getPlaybackRate:k,getPlayedRanges:function(){return K&&\naa?aa.getPlayedRanges():null},getEnded:q,getIsDynamic:function(){return Q},getStreamController:function(){return ca},setLiveStartTime:function(b){X=b},getLiveStartTime:function(){return X},computeLiveDelay:function(b,c){var d=N.getMpd(U.getValue()),e;b=(e=E.getUseSuggestedPresentationDelay()&&d.hasOwnProperty(G.SUGGESTED_PRESENTATION_DELAY)?d.suggestedPresentationDelay:E.getLowLatencyEnabled()?0:E.getLiveDelay()?E.getLiveDelay():isNaN(b)?2*K.manifestInfo.minBufferTime:b*E.getLiveDelayFragmentCount(),\nd.availabilityStartTime&&(F=d.availabilityStartTime.getTime()),0<c)?Math.min(e,Math.max(c-10,c/2)):e;return ia=b,b},getLiveDelay:function(){return ia},getCurrentLiveLatency:function(){if(!Q||isNaN(F))return NaN;var b=m();return isNaN(b)||0===b?0:(Math.round((new Date).getTime()-(1E3*b+F))/1E3).toFixed(3)},play:d,isPaused:e,pause:f,isSeeking:g,seek:h,reset:n},n(),Ma}function w(b){var c=(b=b||{}).timelineConverter,d=b.streamProcessor;return{getLiveEdge:function(){if(!(c&&c.hasOwnProperty(\"getExpectedLiveEdge\")&&\nd&&d.hasOwnProperty(\"getCurrentRepresentationInfo\")))throw Error(\"Missing config parameter(s)\");!0;var b=d.getCurrentRepresentationInfo(),e=b.DVRWindow.end;return b.useCalculatedLiveEdgeTime&&(e=c.getExpectedLiveEdge(),c.setClientTimeOffset(e-b.DVRWindow.end)),e},reset:function(){d=c=null}}}function oa(b,c){if(!(b instanceof c))throw new TypeError(\"Cannot call a class as a function\");}function xa(b){function c(b,c,h){var l=NaN;b=b.getCurrentRepresentationInfo();c!==G.FRAGMENTED_TEXT&&(c===G.AUDIO&&\nh?(c=d.getCurrentBufferLevel(e.getReadOnlyMetricsFor(G.VIDEO)),l=isNaN(b.fragmentDuration)?c:Math.max(c,b.fragmentDuration)):(c=b.mediaInfo.streamInfo,l=g.isPlayingAtTopQuality(c)?c.manifestInfo.duration>=f.getLongFormContentDurationThreshold()?f.getBufferTimeAtTopQualityLongForm():f.getBufferTimeAtTopQuality():f.getStableBufferTime()));return l}var d=(b=b||{}).dashMetrics,e=b.metricsModel,f=b.mediaPlayerModel,g=b.abrController;return{execute:function(b,f,g){return d.getCurrentBufferLevel(e.getReadOnlyMetricsFor(f))<\nc(b,f,g)},getBufferTarget:c}}function Na(b){b=b||{};var c=Ja(this.context).getInstance().log,d=b.adapter;return{execute:function(b,e){var f=b.getCurrentRepresentationInfo(),g=f.mediaInfo.type,h=b.getScheduleController(),l=h.getSeekTarget(),m=!isNaN(l),k=b.getBufferController(),l=m?l:d.getIndexHandlerTime(b);if(isNaN(l))return null;if(m&&h.setSeekTarget(NaN),k)k=k.getRangeAt(l),null===k||m||(c(\"Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for\",\ng,\".\",l,\"was changed to\",k.end),l=k.end);if(e)l=e.startTime+e.duration/2,e=d.getFragmentRequestForTime(b,f,l,{timeThreshold:0,ignoreIsFinished:!0});else{for(e=d.getFragmentRequestForTime(b,f,l,{keepIdx:!m});e&&e.action!==$a.ACTION_COMPLETE&&b.getFragmentModel().isFragmentLoaded(e);)e=d.getNextFragmentRequest(b,f);e&&(isNaN(e.startTime+e.duration)||d.setIndexHandlerTime(b,e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+h.getTimeToLoadDelay(),h.setTimeToLoadDelay(0))}return e}}}function Ra(b){function c(){K&&\n!V.isBufferingCompleted()?(ia(\"[ScheduleController][\",X,\"] start\"),Z(),E=!1,ba&&(ba=!1),m(!1),g(0)):ia(\"[ScheduleController][\",X,\"] start denied\")}function d(){E||(ia(\"[ScheduleController][\",X,\"] stop\"),E=!0,clearTimeout(R))}function e(b,c){ka[c]=ka[c]||{};var d=N.getTopQualityIndexFor(b,c);return ka[c][b]!=d&&(ia(\"Top quality \"+b+\" index has changed from \"+ka[c][b]+\" to \"+d),ka[c][b]=d,!0)}function f(){var b=V.getBufferController();if(E||O||Q.isPaused()&&!la)ia(\"[ScheduleController][\",X,\"] - schedule stop!\");\nelse if(b.getIsBufferingCompleted())ia(\"Schedule stop because buffering is completed!\");else{!function(){var b=1.5*(K.fragmentDuration||5),c=J.getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:Q.getTime()+b,threshold:0})[0];if(c&&-1===ha.indexOf(c)&&!I.getIsTextTrack(X)){var d=U.getFastSwitchEnabled(),e=V.getBufferLevel(),f=N.getAbandonmentStateFor(X);c.mediaType&&N.setCurrentSegmentInfoFor(c.mediaType,{index:c.index,startTime:c.startTime,duration:c.duration,url:c.url});var g=!ja.isCurrentTrack(c.mediaInfo)&&\nja.getSwitchMode(c.mediaInfo.type)===ec.TRACK_SWITCH_MODE_NEVER_REPLACE,h=c.quality!==K.quality;d&&(g||h)&&e>=b&&f!==$b.ABANDON_LOAD?(q(c),ia(\"Reloading outdated fragment at index: \",c.index)):c.quality>K.quality&&(ia(\"The buffer has better quality it in then what we would request so set append point to end of buffer!!\"),da=Q.getTime()+V.getBufferLevel())}}();var c=0<ha.length,d=V.getStreamInfo();va||isNaN(Ha)||ga||c||e(K.mediaInfo.type,d.id)||ma.execute(V,X,aa.isVideoTrackPresent())?(m(!0),c||ga||\nN.checkPlaybackQuality(X),function(){C.trigger(x.GET_NEXT_FRAGMENT,{mediaType:X,currentTime:V.getPlaybackController().getTime(),bufferLevel:V.getBufferLevel(),bufferResetInProgress:va,lastInitQuality:isNaN(Ha),switchTrack:ga,isReplacement:c,hasTopQualityChanged:e(K.mediaInfo.type,d.id),bufferLevelRule:ma.execute(V,X,aa.isVideoTrackPresent()),final:va||isNaN(Ha)||ga||c||e(K.mediaInfo.type,d.id)||ma.execute(V,X,aa.isVideoTrackPresent())});var b=V.getFragmentController();if(K.quality!==Ha)ia(\"ScheduleController - \"+\nX+\" - quality has changed, get init request for representationid = \"+K.id),Ha=K.quality,V.switchInitData(K.id);else if(ga)ia(\"ScheduleController - \"+X+\" - switch track has been asked, get init request for \"+X+\" with representationid = \"+K.id),va=ja.getSwitchMode(X)===ec.TRACK_SWITCH_MODE_ALWAYS_REPLACE,V.switchInitData(K.id,va),Ha=K.quality,ga=!1;else{var f=ha.shift();b.isInitializationRequest(f)?V.switchInitData(f.representationId):(b=void 0,V.getBufferController().getIsPruningInProgress()||!(b=\noa.execute(V,f))&&d.manifestInfo&&d.manifestInfo.isDynamic&&ia(\"getNextFragment - \"+X+\" - Playing at the bleeding live edge and frag is not available yet\"),b?(ia(\"ScheduleController - \"+X+\" - getNextFragment - request is \"+b.url),J.executeRequest(b)):(m(!1),g(500)))}}()):g(500)}}function g(b){clearTimeout(R);R=setTimeout(f,b)}function h(b){b.sender&&b.sender.getStreamProcessor()===V&&k(K.quality)}function m(b){O!==b?O=b:ia(\"[ScheduleController][\",X,\"] isFragmentProcessingInProgress is already equal to\",\nb)}function k(b){(b=B.getInitRequest(V,b))&&(b.mediaType&&N.setCurrentSegmentInfoFor(b.mediaType,{index:b.index,startTime:b.startTime,duration:b.duration,url:b.url}),m(!0),J.executeRequest(b))}function q(b){ha.push(b)}function n(b){if(X===b.mediaType&&V.getStreamInfo().id===b.streamInfo.id){if(null==(K=V.getRepresentationInfoForQuality(b.newQuality)))throw Error(\"Unexpected error! - currentRepresentationInfo is null or undefined\");wa[X]=b.newQuality;L(new Date,Pa.REPRESENTATION_SWITCH_STOP_REASON);\nZ();Q.isPaused()&&(za={type:X,oldQuality:b.oldQuality})}}function t(b){if(Q&&J){var c=J.getRequests({state:pb.FRAGMENT_MODEL_EXECUTED,time:Q.getTime(),threshold:0})[0];c&&Q.getTime()>=c.startTime&&((!Ca.mediaInfo||c.mediaInfo.type===Ca.mediaInfo.type&&c.mediaInfo.id!==Ca.mediaInfo.id)&&b&&C.trigger(x.TRACK_CHANGE_RENDERED,{mediaType:X,oldMediaInfo:Ca.mediaInfo,newMediaInfo:c.mediaInfo}),c.quality===Ca.quality&&c.adaptationIndex===Ca.adaptationIndex||!b||wa[X]===c.quality&&(C.trigger(x.QUALITY_CHANGE_RENDERED,\n{mediaType:X,oldQuality:Ca.quality,newQuality:c.quality}),wa[X]=-1,za=null),Ca={mediaInfo:c.mediaInfo,quality:c.quality,adaptationIndex:c.adaptationIndex})}}function p(b){b.error||b.sender.getStreamProcessor()!==V||(K=B.convertDataToRepresentationInfo(b.currentRepresentation),U.getAppendingSourceState()&&(ga=!0))}function u(b){if(!b.error&&V.getStreamInfo().id===b.streamInfo.id){K=V.getCurrentRepresentationInfo();if(ba)if(Q.getIsDynamic()){if(fa.setTimeSyncCompleted(!0),b=V.getLiveEdgeFinder()){b=\nb.getLiveEdge();var d=b-Q.computeLiveDelay(K.fragmentDuration,K.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2),d=B.getFragmentRequestForTime(V,K,d,{ignoreIsFinished:!0});U.getLowLatencyEnabled()?(d=d.duration<U.getLiveDelay()?d.startTime:d.startTime+d.duration-U.getLiveDelay(),Q.setLiveStartTime(d)):Q.setLiveStartTime(d.startTime);(da=Q.getStreamStartTime(!1,b))>K.mediaInfo.streamInfo.start+K.mediaInfo.streamInfo.duration&&Q.seek(da);d=ca.getCurrentManifestUpdate(H.getMetricsFor(G.STREAM));H.updateManifestUpdateInfo(d,\n{currentTime:da,presentationStartTime:b,latency:b-da,clientTimeOffset:fa.getClientTimeOffset()})}}else da=Q.getStreamStartTime(!1),V.getBufferController().setSeekStartTime(da);E&&c()}}function pa(b){b.fragmentModel===J&&(d(),m(!1),ia(\"[ScheduleController] Stream is complete\"),U.getAppendingSourceState()&&c())}function z(b){b.sender===J&&(ia(\"[ScheduleController][\",X,\"] - onFragmentLoadingCompleted\"),I.getIsTextTrack(X)&&m(!1),b.error&&b.request.serviceLocation&&!E&&m(!1),va&&(Aa=b.request),Q.isPaused()&&\nza&&b.request.quality===wa[X]&&(C.trigger(x.QUALITY_CHANGE_RENDERED,{mediaType:X,oldQuality:Ca.quality||za.oldQuality,newQuality:b.request.quality}),wa[X]=-1,za=null))}function ea(){t(!0)}function D(b){b.sender.getStreamProcessor()===V&&(va&&!isNaN(b.startTime)&&(va=!1,J.addExecutedRequest(Aa)),m(!1),g(0))}function v(b){b.streamProcessor===V&&(ia(\"[ScheduleController][onFragmentLoadingAbandoned] for \"+X+\", request: \"+b.request.url+\" has been aborted\"),Q.isSeeking()||ga||(ia(\"[ScheduleController][onFragmentLoadingAbandoned] for \"+\nX+\", request: \"+b.request.url+\" has to be downloaded again, origin is not seeking process or switch track call\"),q(b.request)),m(!1),g(0))}function y(b){b.sender.getStreamProcessor()===V&&d()}function Ea(b){b.sender.getStreamProcessor()===V&&(b.unintended?V.getFragmentModel().removeExecutedRequestsAfterTime(b.from,V.getStreamInfo().duration):V.getFragmentModel().syncExecutedRequestsWithBufferedRange(V.getBufferController().getBuffer().getAllBufferRanges(),V.getStreamInfo().duration),b.hasEnoughSpaceToAppend&&\nE&&c())}function w(b){b.sender.getStreamProcessor()!==V||b.state!==ic.BUFFER_EMPTY||Q.isSeeking()||(ia(\"[ScheduleController][\",X,\"] - Buffer is empty! Stalling!\"),L(new Date,Pa.REBUFFERING_REASON))}function A(b){b.sender.getStreamProcessor()===V&&(d(),m(!1))}function M(){J.abortRequests();d()}function S(b){b.sender.getStreamProcessor()===V&&k(b.index)}function Ga(){!E&&la||c()}function P(b){da=b.seekTime;Y=0;E&&c();b=ca.getCurrentManifestUpdate(H.getMetricsFor(G.STREAM));var d=K.DVRWindow&&Q?K.DVRWindow.end-\nQ.getTime():NaN;H.updateManifestUpdateInfo(b,{latency:d});O?(ia(\"[ScheduleController][onPlaybackSeeking] for \"+X+\", call fragmentModel.abortRequests in order to seek quicker\"),J.abortRequests(),0<=wa[X]&&(B.setIndexHandlerTime(V,da),V.switchInitData(K.id)),m(!1),g(500)):g(0)}function ra(b){F&&(F.playbackspeed=b.playbackRate.toString())}function L(b,c){if(T&&!1===W){var d=F.start;b=b.getTime()-d.getTime();F.duration=b;F.stopreason=c;T.trace.push(F);W=!0}}function Z(){T&&!0===W&&K&&(W=!1,(F=new Pa).representationid=\nK.id,F.start=new Date,F.mstart=1E3*Q.getTime(),F.playbackspeed=Q.getPlaybackRate().toString())}function Qa(){Ha=NaN}function Ta(){O=!1;Y=0;da=NaN;F=T=null;ba=W=!0;Ha=NaN;Ca={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN};ka={};ha=[];E=!0;va=ga=!1;Aa=null}b=b||{};var Ma=this.context,C=l(Ma).getInstance(),H=b.metricsModel,B=b.adapter,ca=b.dashMetrics,I=b.dashManifestModel,fa=b.timelineConverter,U=b.mediaPlayerModel,N=b.abrController,Q=b.playbackController,aa=b.streamController,X=b.type,V=b.streamProcessor,\nja=b.mediaController,ia=b=void 0,J=void 0,K=void 0,ba=void 0,E=void 0,T=void 0,F=void 0,W=void 0,O=void 0,Y=void 0,R=void 0,da=void 0,ma=void 0,oa=void 0,la=void 0,Ca=void 0,ka=void 0,Ha=void 0,ha=void 0,ga=void 0,va=void 0,Aa=void 0,za=void 0,wa={video:-1,audio:-1};return b={initialize:function(){J=V.getFragmentModel();la=U.getScheduleWhilePaused();ma=Dd(Ma).create({abrController:N,dashMetrics:ca,metricsModel:H,mediaPlayerModel:U});oa=Rd(Ma).create({adapter:B});I.getIsTextTrack(X)&&C.on(x.TIMED_TEXT_REQUESTED,\nS,this);C.on(x.QUALITY_CHANGE_REQUESTED,n,this);C.on(x.DATA_UPDATE_STARTED,y,this);C.on(x.DATA_UPDATE_COMPLETED,p,this);C.on(x.FRAGMENT_LOADING_COMPLETED,z,this);C.on(x.STREAM_COMPLETED,pa,this);C.on(x.STREAM_INITIALIZED,u,this);C.on(x.BUFFER_LEVEL_STATE_CHANGED,w,this);C.on(x.BUFFER_CLEARED,Ea,this);C.on(x.BYTES_APPENDED_END_FRAGMENT,D,this);C.on(x.INIT_REQUESTED,h,this);C.on(x.QUOTA_EXCEEDED,A,this);C.on(x.PLAYBACK_SEEKING,P,this);C.on(x.PLAYBACK_STARTED,Ga,this);C.on(x.PLAYBACK_RATE_CHANGED,ra,\nthis);C.on(x.PLAYBACK_TIME_UPDATED,ea,this);C.on(x.URL_RESOLUTION_FAILED,M,this);C.on(x.FRAGMENT_LOADING_ABANDONED,v,this);C.on(x.MANIFEST_UPDATED,Qa,this)},getType:function(){return X},getSeekTarget:function(){return da},setSeekTarget:function(b){da=b},setTimeToLoadDelay:function(b){Y=b},getTimeToLoadDelay:function(){return Y},replaceRequest:q,switchTrackAsked:function(){ga=!0},isStarted:function(){return!1===E},start:c,stop:d,reset:function(){C.off(x.DATA_UPDATE_STARTED,y,this);C.off(x.DATA_UPDATE_COMPLETED,\np,this);C.off(x.BUFFER_LEVEL_STATE_CHANGED,w,this);C.off(x.QUALITY_CHANGE_REQUESTED,n,this);C.off(x.FRAGMENT_LOADING_COMPLETED,z,this);C.off(x.STREAM_COMPLETED,pa,this);C.off(x.STREAM_INITIALIZED,u,this);C.off(x.QUOTA_EXCEEDED,A,this);C.off(x.BYTES_APPENDED_END_FRAGMENT,D,this);C.off(x.BUFFER_CLEARED,Ea,this);C.off(x.INIT_REQUESTED,h,this);C.off(x.PLAYBACK_RATE_CHANGED,ra,this);C.off(x.PLAYBACK_SEEKING,P,this);C.off(x.PLAYBACK_STARTED,Ga,this);C.off(x.PLAYBACK_TIME_UPDATED,ea,this);C.off(x.URL_RESOLUTION_FAILED,\nM,this);C.off(x.FRAGMENT_LOADING_ABANDONED,v,this);C.off(x.MANIFEST_UPDATED,Qa,this);I.getIsTextTrack(X)&&C.off(x.TIMED_TEXT_REQUESTED,S,this);d();t(!1);Ta()},setPlayList:function(b){T=b},getBufferTarget:function(){return ma.getBufferTarget(V,X,aa.isVideoTrackPresent())},finalisePlayList:function(b,c){L(b,c);T=null}},ia=Ja(Ma).getInstance().log.bind(b),Ta(),b}function cb(){function b(){t=null;p=-1;u=!0;pa=[];M=C=A=w=y=v=ea=null}function c(){var b=new Date,c=z,d=1E3*v.getTime();y.addRepresentationSwitch(c.adaptation.type,\nb,d,c.id)}function d(){var b=S.getStreamInfo(),b=b?b.manifestInfo:null,c=A.calcSegmentAvailabilityRange(z,b?b.isDynamic:null);y.addDVRInfo(S.getType(),v.getTime(),b,c)}function e(b){u=!1;q.trigger(x.AST_IN_FUTURE,{delay:b});setTimeout(function(){if(!u){u=!0;q.trigger(x.DATA_UPDATE_STARTED,{sender:n});pa.forEach(function(b){b.segmentAvailabilityRange=null});for(var b=0;b<pa.length;b++)D.updateRepresentation(pa[b],!0)}},b)}function f(b){if(b.sender.getStreamProcessor()===S&&u){var f=b.representation,\ng=y.getMetricsFor(G.STREAM),h=z.adaptation.type;b=y.getMetricsFor(z.adaptation.type);var g=M.getCurrentManifestUpdate(g),l=!1,m=0,k=void 0,n=void 0;f.adaptation.period.mpd.manifest.type!==B.DYNAMIC||f.adaptation.period.mpd.manifest.ignorePostponeTimePeriod||(m=f.segmentAvailabilityRange.end-f.segmentAvailabilityRange.start,m=1E3*(v.computeLiveDelay(z.segmentDuration,S.getStreamInfo().manifestInfo.DVRWindowSize)-m));if(0<m)return d(),e(m),n=new Xa(1,\"Segments update failed\",null),void q.trigger(x.DATA_UPDATE_COMPLETED,\n{sender:this,data:t,currentRepresentation:z,error:n});if(g){for(n=0;n<g.representationInfo.length;n++)if((k=g.representationInfo[n]).index===f.index&&k.mediaType===S.getType()){l=!0;break}l||y.addManifestUpdateRepresentationInfo(g,f.id,f.index,f.adaptation.period.index,S.getType(),f.presentationTimeOffset,f.startNumber,f.segmentInfoType)}a:{f=ea.getQualityFor(h);l=S.getStreamInfo();l=ea.getTopQualityIndexFor(h,l.id);h=ea.getMinAllowedIndexFor(h);void 0!==h&&f<h&&(f=h);f>l&&(f=l);for(h=f;1>h;h++)if(f=\npa[h].segmentInfoType,null===pa[h].segmentAvailabilityRange||!bc.hasInitialization(pa[h])||(f===B.SEGMENT_BASE||f===B.BASE_URL)&&!pa[h].segments){h=!1;break a}h=!0}h&&(u=!1,ea.setPlaybackQuality(S.getType(),S.getStreamInfo(),pa.indexOf(z)),y.updateManifestUpdateInfo(g,{latency:z.segmentAvailabilityRange.end-v.getTime()}),M.getCurrentRepresentationSwitch(b)||c(),q.trigger(x.DATA_UPDATE_COMPLETED,{sender:this,data:t,currentRepresentation:z}))}}function g(b){if(b.isDynamic){b=b.isDynamic;for(var c=void 0,\nd=0,e=pa.length;d<e;d++)(c=pa[d]).segmentAvailabilityRange=A.calcSegmentAvailabilityRange(c,b)}}function h(b){b.sender.getStreamProcessor()===S&&(Ga.getValue().doNotUpdateDVRWindowOnBufferUpdated||d())}function m(b){if(b.mediaType===S.getType()&&S.getStreamInfo().id===b.streamInfo.id&&b.oldQuality!==b.newQuality){var d=b.newQuality;P[d]||(P[d]=!0,D.updateRepresentation(pa[d],!0));z=pa[b.newQuality];d=ea.getThroughputHistory().getAverageThroughput(b.mediaType);isNaN(d)||w.setSavedBitrateSettings(b.mediaType,\nd);c()}}function k(b){if(b.newDuration){var c=z;c&&c.adaptation.period&&(c.adaptation.period.duration=b.newDuration)}}var q=l(this.context).getInstance(),n=void 0,t=void 0,p=void 0,u=void 0,pa=void 0,z=void 0,ea=void 0,D=void 0,v=void 0,y=void 0,w=void 0,A=void 0,C=void 0,M=void 0,S=void 0,Ga=void 0,P=[];return n={initialize:function(){D=S.getIndexHandler()},setConfig:function(b){b.abrController&&(ea=b.abrController);b.domStorage&&(w=b.domStorage);b.metricsModel&&(y=b.metricsModel);b.dashMetrics&&\n(M=b.dashMetrics);b.dashManifestModel&&(C=b.dashManifestModel);b.playbackController&&(v=b.playbackController);b.timelineConverter&&(A=b.timelineConverter);b.manifestModel&&(Ga=b.manifestModel);b.streamProcessor&&(S=b.streamProcessor)},getData:function(){return t},getDataIndex:function(){return p},isUpdating:function(){return u},updateData:function(b,c,d){var e=S.getStreamInfo(),f=ea.getTopQualityIndexFor(d,e.id),g=ea.getMinAllowedIndexFor(d),h=void 0;u=!0;q.trigger(x.DATA_UPDATE_STARTED,{sender:this});\nif(pa=(p=C.getIndexForAdaptation(t,c.period.mpd.manifest,c.period.index),C.getRepresentationsForAdaptation(c)),null!==t&&t.id==b.id||d===G.FRAGMENTED_TEXT||ea.getThroughputHistory().getAverageThroughput(d)||ea.getInitialBitrateFor(d,e),h=ea.getQualityFor(d),void 0!==g&&h<g&&(h=g),h>f&&(h=f),z=pa[h],t=b,d!==G.VIDEO&&d!==G.AUDIO&&d!==G.FRAGMENTED_TEXT)return u=!1,void q.trigger(x.DATA_UPDATE_COMPLETED,{sender:this,data:t,currentRepresentation:z});(P=[])[h]=!0;D.updateRepresentation(pa[h],!0)},getStreamProcessor:function(){return S},\ngetCurrentRepresentation:function(){return z},getRepresentationForQuality:function(b){return pa[b]},getQualityForRepresentationId:function(b){return pa.indexOf(pa.find(function(c){return c.id===b}))},reset:function(){q.off(x.QUALITY_CHANGE_REQUESTED,m,n);q.off(x.REPRESENTATION_UPDATED,f,n);q.off(x.WALLCLOCK_TIME_UPDATED,g,n);q.off(x.BUFFER_LEVEL_UPDATED,h,n);q.off(x.MANIFEST_VALIDITY_CHANGED,k,n);b();P=[]}},b(),q.on(x.QUALITY_CHANGE_REQUESTED,m,n),q.on(x.REPRESENTATION_UPDATED,f,n),q.on(x.WALLCLOCK_TIME_UPDATED,\ng,n),q.on(x.BUFFER_LEVEL_UPDATED,h,n),q.on(x.MANIFEST_VALIDITY_CHANGED,k,n),n}function Y(){function b(b){var c=b.indexOf(\"/\"),d=b.lastIndexOf(\"/\");return-1!==c?d===c+1?b:(-1!==b.indexOf(\"?\")&&(b=b.substring(0,b.indexOf(\"?\"))),b.substring(0,d+1)):\"\"}function c(b){return(b=b.match(q))?b[1]:\"\"}function d(b){return(b=b.match(l))?b[0]:\"\"}function e(b){return!l.test(b)}function f(b){return e(b)&&\"/\"===b.charAt(0)}function g(b){return 0===b.indexOf(\"//\")}var h=void 0,l=/^[a-z][a-z0-9+\\-.]*:/i,m=/^https?:\\/\\//i,\nk=/^https:\\/\\//i,q=/^([a-z][a-z0-9+\\-.]*:\\/\\/[^\\/]+)\\/?/i,n=function(b,c){try{return(new window.URL(b,c)).toString()}catch(rb){return b}},t=function(h,l){var m=b;if(!l||!e(h))return h;f(h)&&(m=c);g(h)&&(m=d);l=m(l);m=\"/\"!==l.charAt(l.length-1)&&\"/\"!==h.charAt(0)?\"/\":\"\";return[l,h].join(m)};try{new window.URL(\"x\",\"http://y\"),h=n}catch(lb){}finally{h=h||t}return{parseBaseUrl:b,parseOrigin:c,parseScheme:d,isRelative:e,isPathAbsolute:f,isSchemeRelative:g,isHTTPURL:function(b){return m.test(b)},isHTTPS:function(b){return k.test(b)},\nresolve:function(b,c){return h(b,c)}}}function mb(b,c){for(;b.length<c;)b=\"0\"+b;return b}function fb(b,c,d){var e,f,g=void 0,h=void 0,l,m=c.length;if(!b)return b;for(;;){if(0>(e=b.indexOf(\"$\"+c))||0>(f=b.indexOf(\"$\",e+m)))return b;if((g=b.indexOf(\"%0\",e+m))>e&&g<f)switch(h=b.charAt(f-1),l=parseInt(b.substring(g+2,f-1),10),h){case \"d\":case \"i\":case \"u\":l=mb(d.toString(),l);break;case \"x\":l=mb(d.toString(16),l);break;case \"X\":l=mb(d.toString(16),l).toUpperCase();break;case \"o\":l=mb(d.toString(8),l);\nbreak;default:return b}else l=d;b=b.substring(0,e)+l+b.substring(f+1)}}function gb(b,c,d,e){var f,g,h=void 0,l=void 0;return l=d.segmentDuration,isNaN(l)&&(l=d.adaptation.period.duration),f=parseFloat((d.adaptation.period.start+e*l).toFixed(5)),g=parseFloat((f+l).toFixed(5)),(h=new Jc).representation=d,h.duration=l,h.presentationStartTime=f,h.mediaStartTime=b.calcMediaTimeFromPresentationTime(h.presentationStartTime,d),h.availabilityStartTime=b.calcAvailabilityStartTimeFromPresentationTime(h.presentationStartTime,\nd.adaptation.period.mpd,c),h.availabilityEndTime=b.calcAvailabilityEndTimeFromPresentationTime(g,d.adaptation.period.mpd,c),h.wallStartTime=b.calcWallTimeForSegment(h,c),h.replacementNumber=h.representation.startNumber+e,h.availabilityIdx=e,h}function db(b,c,d,e,f,g,h,l,m,k){var q,n,t=e/g;f=Math.min(f/g,d.adaptation.period.mpd.maxSegmentDuration);g=void 0;return n=(q=b.calcPresentationTimeFromMediaTime(t,d))+f,(g=new Jc).representation=d,g.duration=f,g.mediaStartTime=t,g.presentationStartTime=q,g.availabilityStartTime=\nd.adaptation.period.mpd.manifest.loadedTime,g.availabilityEndTime=b.calcAvailabilityEndTimeFromPresentationTime(n,d.adaptation.period.mpd,c),g.wallStartTime=b.calcWallTimeForSegment(g,c),g.replacementTime=k||e,g.replacementNumber=g.representation.startNumber+m,h=fb(h,\"Number\",g.replacementNumber),h=fb(h,\"Time\",g.replacementTime),g.media=h,g.mediaRange=l,g.availabilityIdx=m,g}function R(b,c){if(!c||!c.segments)return null;var d=c.segments.length,e=void 0,f;if(b<d&&(e=c.segments[b])&&e.availabilityIdx===\nb)return e;for(f=0;f<d;f++)if((e=c.segments[f])&&e.availabilityIdx===b)return e;return null}function Ia(b,c,d,e,f,g){var h=d.segmentDuration,l=d.adaptation.period.mpd.manifest.minBufferTime,m=d.segmentAvailabilityRange,k=b.calcPeriodRelativeTimeFromMpdRelativeTime(d,m.start),m=b.calcPeriodRelativeTimeFromMpdRelativeTime(d,m.end),q=d.segments,n=2*h;g=g||Math.max(2*l,10*h);var l=NaN,t=null,p=void 0;return k=Math.max(k,0),c&&!b.isTimeSyncCompleted()?{start:Math.floor(k/h),end:Math.floor(m/h)}:(l=q&&\n0<q.length?(t=R(f,d))?b.calcPeriodRelativeTimeFromMpdRelativeTime(d,t.presentationStartTime):0<f?f*h:b.calcPeriodRelativeTimeFromMpdRelativeTime(d,e):0<f?f*h:c?m:k,{start:p=Math.floor(Math.max(l-n,k)/h),end:Math.floor(Math.min(p+g/h,m/h))})}function ya(b,c){var d=(b=b||{}).timelineConverter;return{getSegments:function(b,e,f,g){if(!(d&&d.hasOwnProperty(\"calcMediaTimeFromPresentationTime\")&&d.hasOwnProperty(\"calcSegmentAvailabilityRange\")&&d.hasOwnProperty(\"calcMediaTimeFromPresentationTime\")))throw Error(\"Missing config parameter(s)\");\nif(!b)throw Error(\"no representation\");void 0===e&&(e=null);var h=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate||b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentList,l=h.SegmentTimeline,m=h.SegmentURL_asArray,k=0<b.availableSegmentsNumber,q=void 0,q=g||(-1<f||null!==e?10:1/\n0),n=0;g=0;var t=-1,p=[],u=null,z=void 0,D=void 0,v=void 0,y=void 0,w=v=void 0,Sa=void 0,A=void 0,Hb=function(e,f){var g=h.media,l=e.mediaRange;return m&&(g=m[f].media||\"\",l=m[f].mediaRange),db(d,c,b,n,e.d,A,g,l,t,e.tManifest)},A=b.timescale,l=l.S_asArray;null!==e&&(u=d.calcMediaTimeFromPresentationTime(e,b));D=0;for(e=l.length;D<e;D++){if(y=0,(z=l[D]).hasOwnProperty(\"r\")&&(y=z.r),z.hasOwnProperty(\"t\")&&(g=(n=z.t)/A),0>y)(w=l[D+1])&&w.hasOwnProperty(\"t\")?v=w.t/A:(y=b.segmentAvailabilityRange?b.segmentAvailabilityRange.end:\nd.calcSegmentAvailabilityRange(b,c).end,v=d.calcMediaTimeFromPresentationTime(y,b),b.segmentDuration=z.d/A),y=Math.ceil((v-g)/(z.d/A))-1;if(Sa){if(k)break;t+=y+1}else for(v=0;v<=y;v++)if(t++,p.length>q){if(Sa=!0,k)break}else null!==u?g>=u-z.d/A*1.5&&p.push(Hb(z,t)):t>=f&&p.push(Hb(z,t)),g=(n+=z.d)/A}return k||(b.availableSegmentsNumber=t+1),p}}}function tb(b,c){var d=b.timelineConverter;return{getSegments:function(b,e,f,g){var h=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,\nl=b.segmentDuration,m=b.segmentAvailabilityRange,k=[],q;var n=b.startNumber;f=(e=isNaN(l)&&!c?{start:n,end:n}:Ia(d,c,b,e,f,g)).start;e=e.end;for(q=f;q<=e;q++)(g=gb(d,c,b,q)).replacementTime=(n+q-1)*b.segmentDuration,f=fb(f=h.media,\"Number\",g.replacementNumber),f=fb(f,\"Time\",g.replacementTime),g.media=f,k.push(g);return isNaN(l)?b.availableSegmentsNumber=1:b.availableSegmentsNumber=Math.ceil((m.end-m.start)/l),k}}}function Da(b,c){var d=(b=b||{}).timelineConverter;return{getSegments:function(b,e,f,\ng){var h=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentList,l=h.SegmentURL_asArray.length,m=[];var k=b.startNumber;e=Ia(d,c,b,e,f,g);f=Math.max(e.start,0);for(e=Math.min(e.end,h.SegmentURL_asArray.length-1);f<=e;f++){var q=h.SegmentURL_asArray[f];(g=gb(d,c,b,f)).replacementTime=(k+f-1)*b.segmentDuration;g.media=q.media?q.media:\"\";g.mediaRange=q.mediaRange;g.index=q.index;g.indexRange=q.indexRange;\nm.push(g)}return b.availableSegmentsNumber=l,m}}}function Bb(b,c){var d,e=this.context,f=void 0,g=void 0,h=void 0;return d={getSegments:function(b,c,d,e,l){var m=void 0,k=b.segmentInfoType,q;if(q=k!==B.SEGMENT_BASE&&k!==B.BASE_URL){q=b.segments;var n=!1,t=void 0,p=void 0;q&&0!==q.length?(p=q[0].availabilityIdx,t=q[q.length-1].availabilityIdx,n=d<p||d>t):n=!0;q=n}q&&(k===B.SEGMENT_TIMELINE?m=f.getSegments(b,c,d,l):k===B.SEGMENT_TEMPLATE?m=g.getSegments(b,c,d,l):k===B.SEGMENT_LIST&&(m=h.getSegments(b,\nc,d,l)),e&&e(b,m))}},f=Sd(e).create(b,c),g=Td(e).create(b,c),h=Ud(e).create(b,c),d}function Cb(){return{modifyRequestURL:function(b){return b},modifyRequestHeader:function(b){return b}}}function Db(b){var c=(b=b||{}).requestModifier;return{load:function(b){var d=new Date,e=b.request,f=new XMLHttpRequest;f.open(b.method,b.url,!0);e.responseType&&(f.responseType=e.responseType);e.range&&f.setRequestHeader(\"Range\",\"bytes=\"+e.range);e.requestStartDate||(e.requestStartDate=d);c&&(f=c.modifyRequestHeader(f));\nf.withCredentials=b.withCredentials;f.onload=b.onload;f.onloadend=b.onend;f.onerror=b.onerror;f.timeout=b.timeout;f.ontimeout=b.ontimeout;f.onprogress=b.progress;f.onabort=b.onabort;f.onreadystatechange=function(){2===f.readyState&&b.onHeadersReceived()};f.send();b.response=f},abort:function(b){b.response.abort()},getP2pType:function(){return\"\"}}}function Za(b){var c=void 0,d={cdn:0,p2p:0},e=void 0,f=(b=b||{}).p2pType,g=!1,h=Ja(this.context).getInstance().log;return{load:function(l){e=l;var m=l.request;\nc||(c=new b.supplier(l.url,b.video,m.mediaType),h(\"[P2PLoader]\",\"[\"+f+\"] new sdk loader [\"+m.mediaType+\"]\"));c.onDataArrival=function(b){var e=c&&c.loadInfo();e&&(m.p2pLoadInfo||(m.p2pLoadInfo={cdn:0,p2p:0}),m.p2pLoadInfo.url=e.url);l.progress&&l.progress(null,b,e&&{cdn:e.cdn-d.cdn,p2p:e.p2p-d.p2p});d=e||d};c.onError=function(b,c){h(\"[P2PLoader]\",\"[\"+f+\"] error, status:\"+b+\", msg:\"+c+\", type:\"+m.mediaType);l.response={status:b,statusText:c};g=!1;l.onerror();l.onend()};c.onComplete=function(){h(\"[P2PLoader]\",\n\"[\"+f+\"] onComplete, type:\"+e.request.mediaType);g=!1;l.onload();l.onend()};var k=void 0;m.range?(k=m.range.split(\"-\"),k={from:parseInt(k[0]),to:parseInt(k[1]||\"-1\")}):k={from:0,to:-1};h(\"[P2PLoader]\",\"[\"+f+\"] load \"+m.mediaType+\" url:\"+l.url+\", range: \"+k.from+\"-\"+k.to);c.load(k,l.withCredentials);(k=c.loadInfo())&&(m.p2pLoadInfo||(m.p2pLoadInfo={cdn:0,p2p:0}),m.p2pLoadInfo.url=k.url);g=!0},abort:function(){g=!1;c&&(c.abort(),c.onDataArrival=void 0,c.onError=void 0,c.onComplete=void 0);e.onabort();\ne.onend();h(\"[P2PLoader]\",\"[\"+f+\"] abort sdk [\"+e.request.mediaType+\"]\")},destroySdk:function(){var b=function(){g=!1;c&&(c.destroy(),c=void 0,h(\"[P2PLoader]\",\"[\"+f+\"] destroy sdk [\"+e.request.mediaType+\"]\"));d={cdn:0,p2p:0}};g?(c.onError=function(c,d){h(\"[P2PLoader]\",\"[\"+f+\"] error, status:\"+c+\", msg:\"+d+\", type:\"+e.request.mediaType);e.response={status:c,statusText:d};e.onerror();e.onend();b()},c.onComplete=function(){h(\"[P2PLoader]\",\"[\"+f+\"] detroy sdk onComplete, type:\"+e.request.mediaType);e.onload();\ne.onend();b()}):b()},getUrl:function(){return e.url||\"\"},getP2pType:function(){return f}}}function nb(b){function c(b,c){b.reader.read().then(c).catch(function(){})}var d=(b=b||{}).requestModifier;return{load:function(b){var e=new Date,f=b.request,g=new Headers;f.range&&g.append(\"Range\",\"bytes=\"+f.range);f.requestStartDate||(f.requestStartDate=e);d&&d.modifyRequestHeader({setRequestHeader:function(b,c){g.append(b,c)}});e=void 0;\"function\"==typeof window.AbortController&&(e=new AbortController,b.abortController=\ne);fetch(b.url,{method:b.method,headers:g,credentials:b.withCredentials?\"include\":void 0,signal:e?e.signal:void 0}).then(function(d){b.response||(b.response={});b.response.status=d.status;b.response.statusText=d.statusText;b.response.responseURL=d.url;d.ok||b.onerror();var e=\"\",f=!0,g=!1,h=void 0;try{for(var l,m=d.headers.keys()[Symbol.iterator]();!(f=(l=m.next()).done);f=!0)var k=l.value,e=e+(k+\": \"+d.headers.get(k)+\"\\n\")}catch(Qb){g=!0,h=Qb}finally{try{!f&&m.return&&m.return()}finally{if(g)throw h;\n}}if(b.response.responseHeaders=e,b.onHeadersReceived(),!d.body)return d.arrayBuffer().then(function(c){b.response.response=c;b.progress({loaded:c.byteLength,total:c.byteLength});b.onload();b.onend()});var q=parseInt(d.headers.get(\"Content-Length\"),10),n=0,t=!1,p=new Uint8Array,u=0;b.reader=d.body.getReader();c(b,function qb(d){var e=d.value;if(d.done)return p&&(b.progress({loaded:n,total:isNaN(q)?n:q,lengthComputable:!0}),b.response.response=p.buffer),b.onload(),void b.onend();if(e&&0<e.length){d=\np;if(0===d.length)d=e;else{var f=new Uint8Array(d.length+e.length);d=(f.set(d),f.set(e,d.length),f)}p=d;n+=e.length;e=Fc().getInstance().findLastTopIsoBoxCompleted([\"moov\",\"mdat\"],p,u);e.found?(e=e.lastCompletedOffset+e.size,d=void 0,e===p.length?(d=p,p=new Uint8Array):(d=new Uint8Array(p.subarray(0,e)),p=p.subarray(e)),b.progress({data:d.buffer,lengthComputable:!1,noTrace:!0}),u=0):(u=e.lastCompletedOffset,t||(b.progress({lengthComputable:!1,noTrace:!0}),t=!0))}c(b,qb)})}).catch(function(c){b.onerror&&\nb.onerror(c)})},abort:function(b){if(b.abortController)b.abortController.abort();else if(b.reader)try{b.reader.cancel()}catch(yb){}}}}function Fa(){var b=l(this.context).getInstance();return{capabilityError:function(c){b.trigger(x.ERROR,{error:\"capability\",event:c})},downloadError:function(c,d,e,f,g){b.trigger(x.ERROR,{error:\"download\",event:{id:c,url:d,request:e},code:f,httpCode:g})},manifestError:function(c,d,e,f,g,h){b.trigger(x.ERROR,{error:\"manifestError\",event:{message:c,id:d,manifest:e,event:f},\ncode:g,httpCode:h})},timedTextError:function(c,d,e){b.trigger(x.ERROR,{error:\"cc\",event:{message:c,id:d,cc:e}})},mediaSourceError:function(c,d){b.trigger(x.ERROR,{error:\"mediasource\",event:c,code:d})},mediaKeySessionError:function(c){b.trigger(x.ERROR,{error:\"key_session\",event:c})},mediaKeyMessageError:function(c){b.trigger(x.ERROR,{error:\"key_message\",event:c})},mssError:function(c){b.trigger(x.ERROR,{error:\"mssError\",event:c})}}}function jb(){return{arraybuffer2string:function(b){return String.fromCharCode.apply(null,\nnew Uint8Array(b))},base642ab:function(b){b=window.atob(b);for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0,f=b.length;e<f;e++)d[e]=b.charCodeAt(e);return c},concat:function(b,c){b=new Uint8Array(b);c=new Uint8Array(c);var d=new Uint8Array(b.length+c.length);return d.set(b),d.set(c,b.length),d.buffer}}}function ua(b,c,d){return c in b?Object.defineProperty(b,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):b[c]=d,b}function Ub(b){function c(b){sb[b]&&sb[b].destroySdk&&(sb[b].destroySdk(),\nsb[b]=null)}b=b||{};var d,e,f=this.context,g=l(f).getInstance(),h=b.errHandler,m=b.videoModel,k=b.metricsModel,q=b.mediaPlayerModel,n=b.requestModifier,t=b.useFetch||!1,p=(b.dashMetrics,void 0),u=void 0,z=void 0,v=[],ea=void 0,D={},y=Vd(f).getInstance(),w=[],A=0,C=void 0,M=void 0,P=b.preloadData;return P&&(P.video&&\"string\"==typeof P.video&&(P.video=y.base642ab(P.video)),P.audio&&\"string\"==typeof P.audio&&(P.audio=y.base642ab(P.audio))),d={load:function(b){b.request&&function nc(b,d){var e=2<arguments.length&&\nvoid 0!==arguments[2]?arguments[2]:0,l=b.request,pa=\"\",S=0,w=0;if(l.range){var La=l.range.split(\"-\");if(S=parseInt(La[0]),w=parseInt(La[1]),l.mediaType&&l.representationId&&P&&P[l.mediaType+\"id\"]===l.representationId+\"\"&&P[l.mediaType]){if(w<P[l.mediaType].byteLength)return w+1===P[l.mediaType].byteLength&&(l.preloadEnd=1),void b.success(P[l.mediaType].slice(S,w+1));S<P[l.mediaType].byteLength&&(pa=P[l.mediaType].slice(S,w+1),l.range=P[l.mediaType].byteLength+\"-\"+w,l.preloadEnd=1)}}l.firstByteDate=\nnull;var Ba=[],L=l.representationId,oc=!0,Sa=!0,Ua=new Date,zb=Ua,rb=0,ta=void 0,H=D[L]||0,B=!1,ra=1,Ea=0,Va=void 0;if(l.urls&&1<l.urls.length&&H&&(l.url=l.urls[H],b.url=l.urls[H]),!n||!k||!h)throw Error(\"config object is not correct or missing\");var Wa=n.modifyRequestURL(l.url),ca=function(b){Sa=!1;var c=new Date;l.requestStartDate=Ua;l.requestEndDate=c;l.firstByteDate=l.firstByteDate||c;l.checkExistenceOnly||k.addHttpRequest(l.mediaType,null,l.type,l.url,ta.response?ta.response.responseURL:null,\nl.serviceLocation||null,l.range||null,l.requestStartDate,l.firstByteDate,l.requestEndDate,ta.response?ta.response.status:null,l.duration,ta.response&&ta.response.getAllResponseHeaders?ta.response.getAllResponseHeaders():ta.response?ta.response.responseHeaders:null,b?Ba:null)},lb=function(){if(clearTimeout(Ea),-1!==p.indexOf(ta)){p.splice(p.indexOf(ta),1);Va=!1;var f=ta&&ta.response&&ta.response.status;if(Sa)if(ca(!1),0<d){var m=0,k=0;50>Date.now()-Ua&&(k=1E3*(e+1));(400<=f&&500>f||600<=f)&&(k=0,m=\n0);A=setTimeout(function(){e++;g.trigger(x.REQUEST_RETRYED,{retryTimes:e,representationId:L,status:ta.response&&ta.response.status,url:l.url,mediaType:l.mediaType,range:l.range});q.getP2pPermission()&&4203===f&&(g.trigger(x.PCDN_LOADED_ERROR,{code:wa.DOWNLOAD_PCDN_DISABLED,from:1}),q.setP2pPermission(!1));b.request.urls&&1<b.request.urls.length?(D[L]=e%l.urls.length,H=D[L],b.request.url=l.urls[H],b.url=l.urls[H],d--,z.push(setTimeout(function(){nc(b,d,e)},m))):(d--,z.push(setTimeout(function(){nc(b,\nd,e)},m)))},k)}else h.downloadError(ea[l.type].type,l.url,l,ea[l.type].code,ta.response&&ta.response.status),b.error&&b.error(l,\"error\",ta.response&&ta.response.statusText,ta.response&&ta.response.status),b.complete&&b.complete(l,ta.response&&ta.response.statusText),c(l.mediaType)}},Hb=1E3*e+2050,kb=l.timeout+3E3*e,Ea=setTimeout(function(){q.getP2pPermission()&&Va.getP2pType()&&q.addP2pSDKErrorCount();B=!0;Va.abort(ta);v.push(4106);b.connectTimeout&&b.connectTimeout(l,Hb);lb()},Hb),qb=new Uint8Array;\nif(t&&window.fetch&&\"arraybuffer\"===l.responseType)Va=Wd(f).create({requestModifier:n});else{var La=function(b,c){b=b.match(/^.+\\/([a-zA-Z0-9_\\-\\.]+)\\??[^\\/]+$/)&&b.match(/^.+\\/([a-zA-Z0-9_\\-\\.]+)\\??[^\\/]+$/)[1];c=c.match(/^.+\\/([a-zA-Z0-9_\\-\\.]+)\\??[^\\/]+$/)&&c.match(/^.+\\/([a-zA-Z0-9_\\-\\.]+)\\??[^\\/]+$/)[1];return b&&c&&b===c},yb=window.__DASH_P2P_TYPE__,Qb={yf:window.YFDashIO,xl:window.xyvp&&window.xyvp.Loader,ks:window.KSLoader,pear:window.PearDownloader,bili:window.DIYSdk},I=void 0,lc=void 0,\nfa=void 0;if(yb&&q.getP2pPermission()){var U=yb.match(/([a-z]+)-([a-z0-9]+)/);U&&(I=Qb[U[1]],fa=\"cg2\"===U[2],lc=\"eg\"===U[2]);I||delete window.__DASH_P2P_TYPE__}lc&&I&&0<=l.index?sb[l.mediaType]&&sb[l.mediaType].getP2pType()&&La(sb[l.mediaType].getUrl(),Wa)?Va=sb[l.mediaType]:(c(l.mediaType),Va=Xd(f).create({video:m.getElement(),p2pType:yb,supplier:I}),sb[l.mediaType]=Va):fa&&I&&\"video\"===l.mediaType&&Wa!==M&&(M=Wa,C&&C.destroy(),C=new I(Wa,m.getElement(),\"watch\"));Va||(c(l.mediaType),Va=Yd(f).create({requestModifier:n}))}La=\nl.checkExistenceOnly?da.HEAD:da.GET;yb=q.getXHRWithCredentialsForType(l.type);ta={url:Wa,method:La,withCredentials:yb,timeout:kb,request:l,onload:function(){if(ta.response){if(200<=ta.response.status&&299>=ta.response.status){var c=ta.response.response;pa&&(c=y.concat(pa,ta.response.response),l.range=S+\"-\"+w);ca(!0);b.success&&b.success(c,ta.response.statusText,ta.response.responseURL);b.complete&&b.complete(l,ta.response.statusText)}}else c=qb,pa&&(c=y.concat(pa,qb),l.range=S+\"-\"+w),ca(!0),b.success&&\nb.success(c,\"\",Wa),b.complete&&b.complete(l,\"\")},onend:lb,onerror:lb,ontimeout:function(){v.push(4105);b.timeout&&b.timeout(l,ra,kb);lb()},progress:function(c,d,e){var f=new Date;if(e)for(var g in l.p2pLoadInfo||(l.p2pLoadInfo={}),e)l.p2pLoadInfo[g]=(l.p2pLoadInfo[g]||0)+e[g];if(!c){if(c={lengthComputable:!1,total:0,loaded:0},d&&(qb=y.concat(qb,d),c.loaded=qb.byteLength),l.range)e=l.range.split(\"-\"),d=parseInt(e[0]),(e=parseInt(e[1]))&&(c.total=e-d+1);c.loaded&&c.total&&(c.lengthComputable=!0)}oc&&\n(oc=!1,2E3>(ra=f-Ua)&&clearTimeout(Ea),(!c.lengthComputable||c.lengthComputable&&c.total!==c.loaded)&&(l.firstByteDate=f));c.lengthComputable&&(l.bytesLoaded=c.loaded,l.bytesTotal=c.total);c.noTrace||(Ba.push({s:zb,d:f.getTime()-zb.getTime(),b:[c.loaded?c.loaded-rb:0]}),zb=f,rb=c.loaded);b.progress&&c.loaded&&b.progress(c.loaded)},onabort:function(){clearTimeout(Ea);clearTimeout(A);b.abort&&!B&&b.abort(l)},onHeadersReceived:function(){l.headersReceivedDate=new Date;b.headersReceived&&b.headersReceived(ta.response&&\nta.response.getAllResponseHeaders&&ta.response.getAllResponseHeaders())},loader:Va};La=(new Date).getTime();if(isNaN(l.delayLoadingTime)||La>=l.delayLoadingTime)p.push(ta),Va.load(ta);else{var N={httpRequest:ta};u.push(N);N.delayTimeout=setTimeout(function(){if(-1!==u.indexOf(N)){u.splice(u.indexOf(N),1);try{zb=Ua=new Date,p.push(N.httpRequest),Va.load(N.httpRequest)}catch(Ca){N.httpRequest.onerror()}}},l.delayLoadingTime-La)}}(b,q.getRetryAttemptsForType(b.request.type))},abort:function(){C&&(C.destroy(),\nC=void 0,M=void 0);clearTimeout(A);w.forEach(function(b){return clearTimeout(b)});z.forEach(function(b){return clearTimeout(b)});z=[];u.forEach(function(b){return clearTimeout(b.delayTimeout)});u=[];p.forEach(function(b){b&&b.request&&isNaN(b.request.index)||(b.onloadend=b.onerror=b.onprogress=void 0,b.loader.abort(b),b.onabort())});p=[]},setPreloadData:function(b){(P=b)&&(P.video&&\"string\"==typeof P.video&&(P.video=y.base642ab(P.video)),P.audio&&\"string\"==typeof P.audio&&(P.audio=y.base642ab(P.audio)))}},\np=[],u=[],z=[],ua(e={},da.MPD_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_MANIFEST,code:wa.DOWNLOAD_MPD_ERROR}),ua(e,da.XLINK_EXPANSION_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_XLINK,code:wa.DOWNLOAD_XINK_ERROR}),ua(e,da.INIT_SEGMENT_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_INITIALIZATION,code:wa.DOWNLOAD_INIT_SEGMENT_ERROR}),ua(e,da.MEDIA_SEGMENT_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_CONTENT,code:wa.DOWNLOAD_MEDIA_SEGMENT_ERROR}),ua(e,da.INDEX_SEGMENT_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_CONTENT,code:wa.DOWNLOAD_INDEX_SEGMENT_ERROR}),ua(e,\nda.BITSTREAM_SWITCHING_SEGMENT_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_CONTENT,code:wa.DOWNLOAD_SWITCHING_SEGMENT_ERROR}),ua(e,da.OTHER_TYPE,{type:Ab.DOWNLOAD_ERROR_ID_CONTENT,code:wa.DOWNLOAD_OTHER_ERROR}),ea=e,d}function ob(){function b(){if(!u||!u.hasOwnProperty(\"resolve\"))throw Error(\"setConfig function has to be called previously\");}function c(b){if(b.url){var c=new $a;return c.type=b.init?da.INIT_SEGMENT_TYPE:da.MEDIA_SEGMENT_TYPE,c.url=b.url,c.urls=b.urls,c.range=b.range.start+\"-\"+b.range.end,c.representationId=\nb.representationId,c.mediaType=b.mediaType,c}}function d(b,c,d){b?g.trigger(x.SEGMENTS_LOADED,{segments:b,representation:c,mediaType:d}):g.trigger(x.SEGMENTS_LOADED,{segments:null,representation:c,mediaType:d,error:new Xa(null,\"error loading segments\",null)})}var e=this.context,f=Ja(e).getInstance().log,g=l(e).getInstance(),h=void 0,m=void 0,k=void 0,q=void 0,n=void 0,t=void 0,p=void 0,u=void 0;return{setConfig:function(b){b.baseURLController&&(u=b.baseURLController);b.metricsModel&&(n=b.metricsModel);\nb.mediaPlayerModel&&(t=b.mediaPlayerModel);b.errHandler&&(h=b.errHandler);b.videoModel&&(m=b.videoModel)},initialize:function(){k=Fc(e).getInstance();q=Kc(e).getInstance();p=rc(e).create({errHandler:h,videoModel:m,metricsModel:n,mediaPlayerModel:t,requestModifier:q,preloadData:t.getPreloadData()})},loadInitialization:function rb(d,e){b();var h=null,l=null,m=u.resolve(d.path),q=e||{init:!0,url:m?m.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};f(\"Start searching for initialization.\");\ne=c(q);p.load({request:e,success:function(b){q.bytesLoaded=q.range.end;var c=l=k.parse(b);b=c.getBox(\"ftyp\");var c=c.getBox(\"moov\"),e=null,m=void 0,n=void 0;f(\"Searching for initialization.\");c&&c.isComplete&&(m=b?b.offset:c.offset,n=c.offset+c.size-1,f(\"Found the initialization.  Range: \"+(e=m+\"-\"+n)));(h=e)?(d.range=h,g.trigger(x.INITIALIZATION_LOADED,{representation:d})):(q.range.end=q.bytesLoaded+q.bytesToLoad,rb(d,q))},error:function(){g.trigger(x.INITIALIZATION_LOADED,{representation:d})}});\nf(\"Perform init search: \"+q.url)},loadSegments:function ea(e,g,l,m,q){(b(),!l||void 0!==l.start&&void 0!==l.end)||(l=(l=l?l.toString().split(\"-\"):null)?{start:parseFloat(l[0]),end:parseFloat(l[1])}:null);q=q||d;var n=null,z=null,S=!!l,y=u.resolve(e.path),D={init:!1,url:y?y.url:void 0,urls:y.urls,range:S?l:{start:0,end:1500},searching:!S,bytesLoaded:m?m.bytesLoaded:0,bytesToLoad:1500,representationId:e.id,mediaType:e.adaptation.type};m=c(D);var v=function(){q(null,e,g)};p.load({request:m,success:function(b){if(D.bytesLoaded=\nD.range.end-D.range.start,n=k.parse(b),(z=n.getBox(\"sidx\"))&&z.isComplete){b=z.references;var c=void 0,d=void 0;if(null!=b&&0<b.length&&(c=1===b[0].reference_type),c){f(\"Initiate multiple SIDX load.\");D.range.end=D.range.start+z.size;for(var l=void 0,m=void 0,p=void 0,u=void 0,S=[],y=0,c=(z.offset||D.range.start)+z.size,d=function(b){b?(S=S.concat(b),++y>=m&&q(S,e,g)):q(null,e,g)},l=0,m=b.length;l<m;l++)p=c,u=c+b[l].referenced_size-1,c+=b[l].referenced_size,ea(e,null,{start:p,end:u},D,d)}else{f(\"Parsing segments from SIDX.\");\nd=function(b,c){var d=b.references,e=d.length,f=b.timescale,g=b.earliest_presentation_time;b=c.range.start+b.offset+b.first_offset+b.size;c=[];for(var h,l,m,k,q=0;q<e;q++)m=d[q].subsegment_duration,k=d[q].referenced_size,(h=new Jc).duration=m,h.startTime=g,h.timescale=f,l=b+k-1,h.mediaRange=b+\"-\"+l,c.push(h),g+=m,b+=k;return c}(z,D);try{l=d[d.length-1],p=(l.duration+l.startTime)/l.timescale,e.adaptation.period.min?e.adaptation.period.min=Math.min(e.adaptation.period.min,p):e.adaptation.period.min=\np,u=t.getCachedDurationOffset(\"offset\"),e.adaptation.period.duration=parseFloat((u+e.adaptation.period.min).toFixed(5)),f(\"Set real min period duration \"+e.adaptation.period.duration+\" ( \"+u+\" )\")}catch(of){f(\"Set real period error \"+g)}q(d,e,g)}}else v(),h.mediaSourceError(\"Error parsing \"+g+\" response.\",wa.MEDIA_DECODE_ERROR)},error:v});f(\"Perform SIDX load: \"+D.url)},resetPreloadData:function(){p&&p.setPreloadData(t.getPreloadData())},reset:function(){p.abort();q=k=h=p=null}}}function Fb(b){function c(){S=\n-1;H=0;ra=NaN;Z=L=Ga=null}function d(b,c,d){d=P.resolve(d.path);var e=void 0,f=void 0,g=void 0;return d&&c!==d.url&&z.isRelative(c)?(e=d.url,f=d.urls||[],g=d.serviceLocation,c&&(e=z.resolve(c,e))):f=[e=c],!z.isRelative(e)&&(b.url=e,b.urls=f,b.serviceLocation=g,!0)}function e(b){var c=!1,d=L?L.getStreamInfo().manifestInfo.isDynamic:null;if(d||S!==b.availableSegmentsNumber){var e=R(S,b);e?(c=parseFloat((e.presentationStartTime-b.adaptation.period.start).toFixed(5)),w.getCachedDurationOffset(\"duration\"),\ne=b.adaptation.period.duration,M(b.segmentInfoType+\": \"+c+\" / \"+e),c=(b.segmentInfoType!==B.SEGMENT_TIMELINE||!d)&&c>=e):M(\"isMediaFinished - no segment found\")}else c=!0;return c}function f(b){Z.getSegments(b,Ga,S,g)}function g(b,c){var d=L?L.getStreamInfo().manifestInfo.isDynamic:null;if(b.segments=c,c&&0<c.length&&(ra=isNaN(ra)?c[0].presentationStartTime:Math.min(c[0].presentationStartTime,ra),d&&isNaN(ea.getExpectedLiveEdge())))b=c[c.length-1].presentationStartTime,c=v.getMetricsFor(G.STREAM),\nea.setExpectedLiveEdge(b),v.updateManifestUpdateInfo(y.getCurrentManifestUpdate(c),{presentationStartTime:b})}function h(b){if(!b)throw Error(\"no representation\");b.segments=null;f(b)}function m(b,c,d){var e=(c=c.segments)?c.length:null,f=-1,g=void 0,h=void 0,l=void 0,m=void 0,k;if(c&&0<e){d=null==d?w.getSegmentOverlapToleranceTime():d;for(k=0;k<e;k++)if(l=(h=c[k]).presentationStartTime,m=h.duration,b+(g=null==d?m/2:d)>=l&&b-g<l+m){f=h.availabilityIdx;break}0===b&&0<c[0].presentationStartTime&&(f=\n0)}return f}function k(b){if(null==b)return null;var c=new $a,e=b.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth,g=b.media,h=L?L.getType():null;return g=fb(g,\"Number\",b.replacementNumber),g=fb(g,\"Time\",b.replacementTime),g=function(b){return b?b.split(\"$$\").join(\"$\"):b}(g=function(b,c){if(!c||!b||-1===b.indexOf(\"$RepresentationID$\"))return b;c=c.toString();return b.split(\"$RepresentationID$\").join(c)}(g=\nfb(g,\"Bandwidth\",f),e.id)),c.mediaType=h,c.type=da.MEDIA_SEGMENT_TYPE,c.range=b.mediaRange,c.startTime=b.presentationStartTime,c.duration=b.duration,c.timescale=e.timescale,c.availabilityStartTime=b.availabilityStartTime,c.availabilityEndTime=b.availabilityEndTime,c.wallStartTime=b.wallStartTime,c.quality=e.index,c.index=b.availabilityIdx,c.mediaInfo=L.getMediaInfo(),c.adaptationIndex=e.adaptation.index,c.representationId=e.id,d(c,g,e)?c:void 0}function q(b,c,d){var g=void 0,h=L?L.getType():null,\nl=L?L.getStreamInfo().manifestInfo.isDynamic:null,q=S,n=!!d&&d.keepIdx,t=d?d.timeThreshold:null;d=!(!d||!d.ignoreIsFinished);return b?(Ga!==c&&(Ga=c,M(\"Getting the request for \"+h+\" time : \"+c)),f(b),0>(S=m(c,b,t))&&(f(b),S=m(c,b,t)),0<S&&M(\"Index for \"+h+\" time \"+c+\" is \"+S),!d&&e(b)?((g=new $a).action=$a.ACTION_COMPLETE,g.index=S,g.mediaType=h,g.mediaInfo=L.getMediaInfo(),M(\"Signal complete in getSegmentRequestForTime -\",h)):g=k(R(S,b)),n&&0<=q&&(S=b.segmentInfoType===B.SEGMENT_TIMELINE&&l?S:q),\ng):null}function n(b){b=b.representation;b.segments&&u.trigger(x.REPRESENTATION_UPDATED,{sender:this,representation:b})}function t(b){var c=L?L.getType():null,d=L?L.getStreamInfo().manifestInfo.isDynamic:null;if(!b.error&&c===b.mediaType){var c=b.segments,e=b.representation,f=[],h=0,l=0;w.getAppendingSourceState()&&(Ea=w.getCachedDurationOffset(\"offset\"),l=c[0].startTime,S=0);var m=0;for(b=c.length;m<b;m++){var k=c[m];k=db(ea,d,e,k.startTime+Ea*k.timescale-l,k.duration,k.timescale,k.media,k.mediaRange,\nh);f.push(k);h++}e.segmentAvailabilityRange={start:f[0].presentationStartTime,end:f[b-1].presentationStartTime};e.availableSegmentsNumber=b;g(e,f);bc.hasInitialization(e)&&u.trigger(x.REPRESENTATION_UPDATED,{sender:this,representation:e})}}b=b||{};var p=this.context,u=l(p).getInstance(),z=Ib(p).getInstance(),D=void 0,ea=b.timelineConverter,y=b.dashMetrics,v=b.metricsModel,w=b.mediaPlayerModel,A=b.errHandler,P=b.baseURLController,C=void 0,M=void 0,S=void 0,Ga=void 0,H=void 0,ra=void 0,L=void 0,Z=void 0,\nEa=void 0;return C={initialize:function(c){c=(L=c)?L.getStreamInfo().manifestInfo.isDynamic:null;D.initialize();Z=Zd(p).create(b,c)},getStreamProcessor:function(){return L},getInitRequest:function(b){var c=L?L.getType():null;if(b){var e=new $a,f=b.adaptation.period,g=f.start,h=L?L.getStreamInfo().manifestInfo.isDynamic:null;b=(e.mediaType=c,e.type=da.INIT_SEGMENT_TYPE,e.range=b.range,e.availabilityStartTime=ea.calcAvailabilityStartTimeFromPresentationTime(g,f.mpd,h),e.availabilityEndTime=ea.calcAvailabilityEndTimeFromPresentationTime(g+\nf.duration,f.mpd,h),e.quality=b.index,e.mediaInfo=L?L.getMediaInfo():null,e.representationId=b.id,d(e,b.initialization,b))?e:void 0}else b=null;return b},getSegmentRequestForTime:q,getNextSegmentRequest:function(b){var c=void 0,d=void 0,g=L?L.getType():null,h=L?L.getStreamInfo().manifestInfo.isDynamic:null;return b&&-1!==S?(Ga=null,S++,M(\"Getting the next request at index: \"+S+\", type: \"+g),!R(S,b)&&h?(M(\"No segment found at index: \"+S+\". Wait for next loop\"),f(b),S--,null):(e(b)?((c=new $a).action=\n$a.ACTION_COMPLETE,c.index=S,c.mediaType=g,c.mediaInfo=L.getMediaInfo(),M(\"Signal complete -\",g)):(f(b),c=k(d=R(S,b)),!d&&h&&S--),c)):null},generateSegmentRequestForTime:function(b,c){var d=(b.segmentAvailabilityRange.end-b.segmentAvailabilityRange.start)/2;return b.segments=null,b.segmentAvailabilityRange={start:c-d,end:c+d},q(b,c,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(b,c){var d=bc.hasInitialization(b),e=bc.hasSegments(b),f=L?L.getType():null,g=L?L.getStreamInfo().manifestInfo.isDynamic:\nnull,l=void 0;if(b.segmentDuration||b.segments||h(b),b.segmentAvailabilityRange=ea.calcSegmentAvailabilityRange(b,g),b.segmentAvailabilityRange.end<b.segmentAvailabilityRange.start&&!b.useCalculatedLiveEdgeTime)return l=new Xa(1,\"no segments are available yet\",{availabilityDelay:b.segmentAvailabilityRange.start-b.segmentAvailabilityRange.end}),void u.trigger(x.REPRESENTATION_UPDATED,{sender:this,representation:b,error:l});c||(S=-1);b.segmentDuration&&h(b);d||D.loadInitialization(b);e||D.loadSegments(b,\nf,b.indexRange);d&&e&&u.trigger(x.REPRESENTATION_UPDATED,{sender:this,representation:b})},updateSegmentList:h,setCurrentTime:function(b){w.getCachedDurationOffset(\"duration\")&&(b=Math.min(w.getCachedDurationOffset(\"duration\"),b));H=b},getCurrentTime:function(){return H},getEarliestTime:function(){return ra},resetPreloadData:function(){D&&D.resetPreloadData()},reset:function(){c();u.off(x.INITIALIZATION_LOADED,n,C);u.off(x.SEGMENTS_LOADED,t,C)}},M=Ja(p).getInstance().log.bind(C),c(),(D=$d(p).getInstance()).setConfig({baseURLController:P,\nmetricsModel:v,mediaPlayerModel:w,videoModel:b.videoModel,errHandler:A}),Ea=0,u.on(x.INITIALIZATION_LOADED,n,C),u.on(x.SEGMENTS_LOADED,t,C),C}function Gb(b){function c(){B=[]}function d(){return t?t.getStreamInfo():null}b=b||{};var e=this.context,f=void 0,g=b.type,h=b.errHandler,l=b.mimeType,m=b.timelineConverter,k=b.adapter,q=b.manifestModel,n=b.mediaPlayerModel,t=b.stream,p=b.abrController,u=b.playbackController,z=b.streamController,ea=b.mediaController,D=b.domStorage,y=b.metricsModel,v=b.dashMetrics,\nw=b.dashManifestModel,A=void 0,C=void 0,P=void 0,S=void 0,x=void 0,M=void 0,H=void 0,L=void 0,B=void 0,A={initialize:function(c){(f=ae(e).create({mimeType:l,timelineConverter:m,dashMetrics:v,metricsModel:y,mediaPlayerModel:n,baseURLController:b.baseURLController,videoModel:b.videoModel,errHandler:h})).initialize(A);p.registerStreamType(g,A);(L=t.getFragmentController().getModel(g)).setStreamProcessor(A);var d=g,pa=null;d!==G.VIDEO&&d!==G.AUDIO||(pa=ic(e).create({type:d,metricsModel:y,mediaPlayerModel:n,\nmanifestModel:q,errHandler:h,streamController:z,mediaController:ea,adapter:k,abrController:p,playbackController:u,streamProcessor:A}));S=pa;x=be(e).create({type:g,metricsModel:y,adapter:k,dashMetrics:v,dashManifestModel:w,timelineConverter:m,mediaPlayerModel:n,abrController:p,playbackController:u,streamController:z,streamProcessor:A,mediaController:ea});(H=ce(e).create()).setConfig({abrController:p,domStorage:D,metricsModel:y,dashMetrics:v,dashManifestModel:w,manifestModel:q,playbackController:u,\ntimelineConverter:m,streamProcessor:A});S.initialize(c);x.initialize();H.initialize()},isUpdating:function(){return!!H&&H.isUpdating()},getType:function(){return g},getBufferController:function(){return S},getFragmentModel:function(){return L},getScheduleController:function(){return x},getLiveEdgeFinder:function(){return M},getEventController:function(){return t?t.getEventController():null},getFragmentController:function(){return t?t.getFragmentController():null},getRepresentationController:function(){return H},\ngetIndexHandler:function(){return f},getCurrentRepresentationInfo:function(){return k.getCurrentRepresentationInfo(H)},getRepresentationInfoForQuality:function(b){return k.getRepresentationInfoForQuality(H,b)},getBufferLevel:function(){return S.getBufferLevel()},switchInitData:function(b,c){S&&S.switchInitData(d().id,b,c)},isBufferingCompleted:function(){return!!S&&S.getIsBufferingCompleted()},createBuffer:function(){return S.getBuffer()||S.createBuffer(C)},getStreamInfo:d,updateMediaInfo:function(b){b===\nC||b&&C&&b.type!==C.type||(C=b);-1===P.indexOf(b)&&P.push(b);k.updateData(this)},switchTrackAsked:function(){x.switchTrackAsked()},getMediaInfoArr:function(){return P},getMediaInfo:function(){return C},getMediaSource:function(){return S.getMediaSource()},setMediaSource:function(b){S.setMediaSource(b,C)},dischargePreBuffer:function(){S.dischargePreBuffer()},getBuffer:function(){return S.getBuffer()},setBuffer:function(b){S.setBuffer(b)},registerExternalController:function(b){B.push(b)},unregisterExternalController:function(b){b=\nB.indexOf(b);-1!==b&&B.splice(b,1)},getExternalControllers:function(){return B},unregisterAllExternalController:c,getPlaybackController:function(){return u},resetPreloadData:function(){L.resetPreloadData();f.resetPreloadData()},reset:function(b){f.reset();S&&(S.reset(b),S=null);x&&(x.reset(),x=null);H&&(H.reset(),H=null);p&&p.unRegisterStreamType(g);B.forEach(function(b){b.reset()});P=[];C=null;c();t=g=null;M&&(M.reset(),M=null)}};u&&u.getIsDynamic()&&(M=Cd(e).create({timelineConverter:m,streamProcessor:A}));\nP=[];C=null;c();return A}function Wb(){function b(){v=!1;q={};n={};t={};p=null;z=(u=100)/1E3}function c(){if(!D||!ea||!y)throw Error(\"setConfig function has to be called previously\");}function d(){null!==p&&v&&(clearInterval(p),p=null,v=!1)}function e(){f(n);f(q);if(t)for(var b=y.getTime(),c=Object.keys(t),d=0;d<c.length;d++){var e=c[d],g=t[e];null!==g&&(g.duration+g.presentationTime)/g.eventStream.timescale<b&&(m(\"Remove Event \"+e+\" at time \"+b),delete t[e])}}function f(b){var d,e=y.getTime();if(b)for(var f=\nObject.keys(b),g=0;g<f.length;g++){var h=f[g],l=b[h];void 0!==l&&(0===(d=l.presentationTime/l.eventStream.timescale)||d<=e&&d+z>e)&&(m(\"Start Event \"+h+\" at \"+e),0<l.duration&&(t[h]=l),\"urn:mpeg:dash:event:2012\"==l.eventStream.schemeIdUri&&1==l.eventStream.value?0===l.duration&&0===l.presentationTimeDelta||(c(),ea.refreshManifest()):k.trigger(l.eventStream.schemeIdUri,{event:l}),delete b[h])}}var g,h=this.context,m=Ja(h).getInstance().log,k=l(h).getInstance(),q=void 0,n=void 0,t=void 0,p=void 0,u=\nvoid 0,z=void 0,D=void 0,ea=void 0,y=void 0,v=void 0;return g={addInlineEvents:function(b){if(c(),q={},b)for(var d=0;d<b.length;d++){var e=b[d];q[e.id]=e;m(\"Add inline event with id \"+e.id)}m(\"Added \"+b.length+\" inline events\")},addInbandEvents:function(b){c();for(var d=0;d<b.length;d++){var e=b[d];if(e.id in n)m(\"Repeated event with id \"+e.id);else{if(\"urn:mpeg:dash:event:2012\"===e.eventStream.schemeIdUri&&void 0===n[e.id]){var f=e;if(1==f.eventStream.value){var g=f.eventStream.timescale||1,h=f.presentationTime/\ng,g=4294967295==f.presentationTime?NaN:(f.presentationTime+f.duration)/g;m(\"Manifest validity changed: Valid until: \"+h+\"; remaining duration: \"+g);k.trigger(x.MANIFEST_VALIDITY_CHANGED,{id:f.id,validUntil:h,newDuration:g,newManifestValidAfter:NaN})}}n[e.id]=e;m(\"Add inband event with id \"+e.id)}}},stop:d,start:function(){c();m(\"Start Event Controller\");v||isNaN(u)||(v=!0,p=setInterval(e,u))},setConfig:function(b){b&&(b.manifestModel&&(D=b.manifestModel),b.manifestUpdater&&(ea=b.manifestUpdater),\nb.playbackController&&(y=b.playbackController))},reset:function(){d();b()}},b(),g}function Mb(b){b=b||{};var c=this.context,d=l(c).getInstance(),e=void 0,f=void 0,g=void 0;return e={checkForExistence:function(b){var c=function(c){d.trigger(x.CHECK_FOR_EXISTENCE_COMPLETED,{request:b,exists:c})};if(b){var e=new de(b.url);f.load({request:e,success:function(){c(!0)},error:function(){c(!1)}})}else c(!1)},load:function ta(c){var g=function(f,g){!g&&(d.trigger(x.LOADING_COMPLETED,{request:c,response:f||\nnull,error:g||null,sender:e}),c.preloadEnd)&&(b.mediaPlayerModel.setPreloadData(null),f=b.abrController.getDefaultQualityFor(c.mediaType,!1),b.abrController.setPlaybackQuality(c.mediaType,b.streamController.getActiveStreamInfo(),f))};c?(void 0===c.retry&&(c.retry=1),f.load({request:c,progress:function(b){b&&d.trigger(x.LOADING_DATA_PROGRESS,{request:c,response:b||null,error:null,sender:e})},success:function(b){try{var e=void 0;if(c.range)var f=c.range&&c.range.split(\"-\"),e=f[1]-f[0]+1;var h={mediaType:c.mediaType,\nid:c.representationId,index:c.index,range:c.range,received:b&&b.byteLength||0,url:c.url,startTime:c.startTime,duration:c.duration,p2pLoadInfo:c.p2pLoadInfo};b&&3E7<b.byteLength&&(h.code=wa.DOWNLOAD_FRAGMENT_ERROR_RANGE,d.trigger(x.FRAGMENT_LOADED_ERROR,h));!b||b.byteLength!==e&&e?(h&&h.hasOwnProperty(\"type\")&&delete h.type,c.retry&&0<c.retry?(h.code=wa.DOWNLOAD_FRAGMENT_ERROR,d.trigger(x.FRAGMENT_LOADED_ERROR,h),c.retry--,ta(c)):(h.code=wa.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE,d.trigger(x.FRAGMENT_LOADED_ERROR,\nh))):(1===c.retry||(h.code=wa.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS,d.trigger(x.FRAGMENT_LOADED_ERROR,h)),g(b))}catch(pa){(undefined)}},timeout:function(b,c,e){b={mediaType:b.mediaType,id:b.representationId,index:b.index,range:b.range,received:b.bytesLoaded,url:b.url,startTime:b.startTime,duration:b.duration,total:b.bytesTotal,latency:c,timeout:e,p2pLoadInfo:b.p2pLoadInfo};b.code=wa.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT;d.trigger(x.FRAGMENT_LOADED_ERROR,b);g(void 0,new Xa(1,\n\"request timeout\"))},error:function(b,c,d){g(void 0,new Xa(1,d,c))},abort:function(b){b&&d.trigger(x.LOADING_ABANDONED,{request:b,mediaType:b.mediaType,sender:e})},connectTimeout:function(b,c){b&&(b={mediaType:b.mediaType,id:b.representationId,index:b.index,range:b.range,received:b.bytesLoaded||0,url:b.url,startTime:b.startTime,duration:b.duration,total:b.bytesTotal,timeout:c,p2pLoadInfo:b.p2pLoadInfo},b.code=wa.CONNECT_FRAGMENT_ERROR_TIMEOUT,d.trigger(x.FRAGMENT_LOADED_ERROR,